# æ™ºèƒ½æµ‹è¯•åŠ©æ‰‹ï¼ˆIntelligent Testing Agentï¼‰å¼€å‘æ–‡æ¡£

> **ç‰ˆæœ¬**: v1.0  
> **æ—¥æœŸ**: 2024-12-08  
> **çŠ¶æ€**: è®¾è®¡å®Œæˆï¼Œå¾…å¼€å‘

---

## ç›®å½•

- [1. é¡¹ç›®èƒŒæ™¯](#1-é¡¹ç›®èƒŒæ™¯)
- [2. åŠŸèƒ½ç›®æ ‡](#2-åŠŸèƒ½ç›®æ ‡)
- [3. æ•´ä½“æ¶æ„](#3-æ•´ä½“æ¶æ„)
- [4. UIè®¾è®¡](#4-uiè®¾è®¡)
- [5. æŠ€æœ¯å®ç°æ–¹æ¡ˆ](#5-æŠ€æœ¯å®ç°æ–¹æ¡ˆ)
- [6. æ•°æ®åº“è®¾è®¡](#6-æ•°æ®åº“è®¾è®¡)
- [7. åç«¯å®ç°](#7-åç«¯å®ç°)
- [8. å‰ç«¯å®ç°](#8-å‰ç«¯å®ç°)
- [9. WebSocketæ¶ˆæ¯åè®®](#9-websocketæ¶ˆæ¯åè®®)
- [10. Agent Promptè®¾è®¡](#10-agent-promptè®¾è®¡)
- [11. å¼€å‘è®¡åˆ’](#11-å¼€å‘è®¡åˆ’)

---

## 1. é¡¹ç›®èƒŒæ™¯

### 1.1 ç°æœ‰èƒ½åŠ›

é¡¹ç›®å·²å…·å¤‡ä»¥ä¸‹åŸºç¡€èƒ½åŠ›ï¼Œå¯ä½œä¸ºæ™ºèƒ½æµ‹è¯•åŠ©æ‰‹çš„æ”¯æ’‘ï¼š

**Codingéœ€æ±‚æ–‡æ¡£æŸ¥è¯¢**
- `CodingService`: é›†æˆCodingå¹³å°OpenAPI
- æ”¯æŒè·å–éœ€æ±‚è¯¦æƒ…ã€å›¾ç‰‡æ›¿æ¢ã€PDFå¯¼å‡º
- API: `/api/v1/coding/issue/detail`

**å¤šæ¨¡æ€æ–‡æ¡£è§£æ**
- `document_parser.py`: æ”¯æŒPDFã€DOCXã€Excelã€CSVç­‰æ ¼å¼
- æŒ‰é¡µæå–æ–‡æœ¬å’Œå›¾ç‰‡ï¼Œä¿ç•™ç»“æ„å…³ç³»
- å›¾ç‰‡è‡ªåŠ¨ä¸Šä¼ OSS

**ä¸šåŠ¡ç†è§£ä¸ä»£ç æŸ¥è¯¢**
- 16ä¸ªçŸ¥è¯†å›¾è°±å·¥å…·ï¼ˆä¸šåŠ¡æµç¨‹ã€æ¥å£ã€æ•°æ®èµ„æºï¼‰
- 5ä¸ªä»£ç æ£€ç´¢å·¥å…·ï¼ˆMCPè¯­ä¹‰æœç´¢ã€grepã€æ–‡ä»¶è¯»å–ï¼‰
- Neo4jå›¾æ•°æ®åº“æ”¯æŒ

**å¤šAgentæ¶æ„**
- AgentRegistryå•ä¾‹ç®¡ç†
- æ”¯æŒknowledge_qaã€log_troubleshootä¸¤ç§Agent
- LangChain + AsyncSqliteSaverå®ç°ä¼šè¯ç®¡ç†

### 1.2 ä¸šåŠ¡éœ€æ±‚

æµ‹è¯•å›¢é˜Ÿé¢ä¸´çš„ç—›ç‚¹ï¼š
- äººå·¥ç¼–å†™æ•ˆç‡ä½ï¼šä¸€ä¸ªéœ€æ±‚éœ€è¦50+ç”¨ä¾‹ï¼Œè€—æ—¶2-3å¤©
- è¦†ç›–ç‡éš¾ä¿è¯ï¼šå®¹æ˜“é—æ¼è¾¹ç•Œåœºæ™¯å’Œå¼‚å¸¸åˆ†æ”¯
- ä»£ç ç†è§£æˆæœ¬é«˜ï¼šæµ‹è¯•äººå‘˜ä¸ç†Ÿæ‚‰ä»£ç å®ç°ç»†èŠ‚
- ç»´æŠ¤æˆæœ¬é«˜ï¼šéœ€æ±‚å˜æ›´åç”¨ä¾‹æ›´æ–°æ»å

### 1.3 è§£å†³æ–¹æ¡ˆ

æ„å»ºæ™ºèƒ½æµ‹è¯•åŠ©æ‰‹Agentï¼Œæ”¯æŒä¸‰ä¸ªé€’è¿›é˜¶æ®µï¼š
1. **æµ‹è¯•æ–¹æ¡ˆç”Ÿæˆ**: åŸºäºéœ€æ±‚å’Œä»£ç ï¼Œç”Ÿæˆæµ‹è¯•ç­–ç•¥ã€èŒƒå›´ã€é£é™©åˆ†æ
2. **æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆ**: è‡ªåŠ¨ç”ŸæˆåŠŸèƒ½ã€è¾¹ç•Œã€å¼‚å¸¸ä¸‰ç±»ç”¨ä¾‹
3. **æµ‹è¯•ç”¨ä¾‹è¯„å®¡**: æ™ºèƒ½è¯„å®¡ç”¨ä¾‹è¦†ç›–åº¦ã€è§„èŒƒæ€§ï¼Œæä¾›ä¼˜åŒ–å»ºè®®

---

## 2. åŠŸèƒ½ç›®æ ‡

### 2.1 æ ¸å¿ƒåŠŸèƒ½
- åŸºäºCodingéœ€æ±‚IDè‡ªåŠ¨åˆ†æéœ€æ±‚æ–‡æ¡£
- æ·±å…¥ç†è§£ä¸šåŠ¡æµç¨‹å’Œä»£ç å®ç°
- ç”Ÿæˆç»“æ„åŒ–æµ‹è¯•æ–¹æ¡ˆ
- è‡ªåŠ¨ç”Ÿæˆ50+ç»“æ„åŒ–æµ‹è¯•ç”¨ä¾‹
- æ™ºèƒ½è¯„å®¡ç”¨ä¾‹è´¨é‡å¹¶æä¾›ä¼˜åŒ–å»ºè®®

### 2.2 ç”¨æˆ·ä½“éªŒç›®æ ‡
- **å¯è§†åŒ–ä»»åŠ¡è¿½è¸ª**: å·¦ä¾§é¢æ¿å®æ—¶å±•ç¤ºAIæ‰§è¡Œçš„ä»»åŠ¡åˆ—è¡¨
- **é˜¶æ®µåŒ–æ¨è¿›**: å³ä¾§æ—¶é—´çº¿æ¸…æ™°å±•ç¤ºä¸‰ä¸ªé˜¶æ®µçš„è¿›åº¦
- **é€æ˜åŒ–æ€è€ƒ**: ä¸­é—´å¯¹è¯åŒºå±•ç¤ºAIçš„æ€è€ƒè¿‡ç¨‹å’Œå·¥å…·è°ƒç”¨
- **å¯å¹²é¢„æ€§**: ç”¨æˆ·å¯æš‚åœã€è·³è¿‡ä»»åŠ¡ï¼Œéšæ—¶æŸ¥çœ‹ä¸­é—´äº§ç‰©

### 2.3 æŠ€æœ¯ç›®æ ‡
- å¤ç”¨ç°æœ‰Agentæ¶æ„ï¼ˆLangChain + checkpointerï¼‰
- é‡‡ç”¨å·¥å…·è°ƒç”¨ï¼ˆè€Œéç‰¹æ®Šæ ‡ç­¾ï¼‰ä¿è¯å¯é æ€§
- ç¬¬ä¸€é˜¶æ®µæ·±åº¦åˆ†æï¼Œåç»­é˜¶æ®µå¤ç”¨åˆ†æç»“æœ
- å¼€å‘å‘¨æœŸ: 10-16å¤©

---

## 3. æ•´ä½“æ¶æ„

### 3.1 ä¸‰é˜¶æ®µå·¥ä½œæµ

```
é˜¶æ®µ1: éœ€æ±‚åˆ†æä¸ä¸šåŠ¡ç†è§£
â”œâ”€ è§£æCodingéœ€æ±‚æ–‡æ¡£
â”œâ”€ åˆ†æä¸šåŠ¡æµç¨‹ï¼ˆå¤šä¸ªåŠŸèƒ½æ¨¡å—ï¼‰
â”œâ”€ ä»£ç é€»è¾‘æ·±åº¦åˆ†æ
â””â”€ ç”Ÿæˆé˜¶æ®µæ‘˜è¦ï¼ˆå­˜å…¥SQLiteï¼‰
   Tokenæ¶ˆè€—: 10-15K

é˜¶æ®µ2: æµ‹è¯•æ–¹æ¡ˆç”Ÿæˆ
â”œâ”€ è¯»å–é˜¶æ®µ1æ‘˜è¦
â”œâ”€ åˆ¶å®šæµ‹è¯•èŒƒå›´å’Œç­–ç•¥
â”œâ”€ é£é™©ç‚¹åˆ†æ
â””â”€ ç”Ÿæˆæµ‹è¯•æ–¹æ¡ˆ
   Tokenæ¶ˆè€—: 2-3K

é˜¶æ®µ3: æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆ
â”œâ”€ è¯»å–é˜¶æ®µ2æ–¹æ¡ˆ
â”œâ”€ åˆ†åŠŸèƒ½ç”Ÿæˆç”¨ä¾‹
â”‚  â”œâ”€ åŠŸèƒ½ç”¨ä¾‹ï¼ˆæ­£å¸¸æµç¨‹ï¼‰
â”‚  â”œâ”€ è¾¹ç•Œç”¨ä¾‹ï¼ˆè¾¹ç•Œå€¼ï¼‰
â”‚  â””â”€ å¼‚å¸¸ç”¨ä¾‹ï¼ˆå¼‚å¸¸åˆ†æ”¯ï¼‰
â””â”€ ç»Ÿè®¡è¦†ç›–ç‡
   Tokenæ¶ˆè€—: 5-10K
```

### 3.2 æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯é€‰å‹ | è¯´æ˜ |
|-----|---------|------|
| **Agentæ¡†æ¶** | LangChain Agent + AsyncSqliteSaver | å¤ç”¨ç°æœ‰æ¶æ„ |
| **ä¼šè¯ç¼“å­˜** | SQLite + JSONå­—æ®µ | å­˜å‚¨é˜¶æ®µåˆ†æç»“æœ |
| **çŠ¶æ€ç®¡ç†** | Toolè°ƒç”¨ + WebSocket + React State | å¯é çš„ä¸‰å±‚æ¶æ„ |
| **å‰ç«¯UI** | React + TypeScript + Ant Design | å¤ç”¨ç°æœ‰ç»„ä»¶åº“ |
| **å®æ—¶é€šä¿¡** | WebSocket | å¤ç”¨ç°æœ‰æ¨é€æœºåˆ¶ |

---

## 4. UIè®¾è®¡

### 4.1 æ•´ä½“å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é¡¶éƒ¨é…ç½®åŒºï¼š[Agent: æµ‹è¯•åŠ©æ‰‹â–¼] [é¡¹ç›®â–¼] [è¿­ä»£â–¼] [éœ€æ±‚â–¼] [å¼€å§‹ğŸš€] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            â”‚                                  â”‚                 â”‚
â”‚  å·¦ä¾§é¢æ¿   â”‚          ä¸­é—´å¯¹è¯åŒº               â”‚   å³ä¾§æ—¶é—´çº¿     â”‚
â”‚  (240px)   â”‚          (flex: 1)              â”‚   (280px)       â”‚
â”‚            â”‚                                  â”‚                 â”‚
â”‚  ä»»åŠ¡è¿½è¸ª   â”‚  â€¢ ç”¨æˆ·æ¶ˆæ¯                       â”‚  å·¥ä½œæµæ—¶é—´çº¿    â”‚
â”‚  çœ‹æ¿      â”‚  â€¢ AIæ€è€ƒè¿‡ç¨‹                     â”‚                 â”‚
â”‚  (å›ºå®š)    â”‚  â€¢ å·¥å…·è°ƒç”¨å¡ç‰‡                   â”‚  â‘  ğŸ”„ 35%     â”‚
â”‚            â”‚  â€¢ AIå›å¤                        â”‚  â‘¡ â¸ï¸         â”‚
â”‚  âœ… ä»»åŠ¡1   â”‚  â€¢ é˜¶æ®µåˆ†éš”çº¿                     â”‚  â‘¢ â¸ï¸         â”‚
â”‚  ğŸ”„ ä»»åŠ¡2   â”‚  â€¢ å…³é”®äº§ç‰©é«˜äº®                   â”‚                 â”‚
â”‚  â¸ï¸ ä»»åŠ¡3   â”‚                                  â”‚  æ€»è¿›åº¦: 12%   â”‚
â”‚            â”‚  (å¤ç”¨ç°æœ‰æ ·å¼)                   â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 å·¦ä¾§ä»»åŠ¡è¿½è¸ªé¢æ¿

#### é¢æ¿ç»“æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“‹ ä»»åŠ¡è¿½è¸ªçœ‹æ¿            â”‚
â”‚  éœ€æ±‚: #12345              â”‚
â”‚  é˜¶æ®µ: éœ€æ±‚åˆ†æ (1/3)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                           â”‚
â”‚  âœ… 1. è§£æéœ€æ±‚æ–‡æ¡£         â”‚
â”‚     â””â”€ æå–5ä¸ªåŠŸèƒ½ç‚¹        â”‚
â”‚                           â”‚
â”‚  ğŸ”„ 2. åˆ†æä¸šåŠ¡: æœˆå¡å¼€é€š   â”‚
â”‚     è¿›è¡Œä¸­... 40%          â”‚
â”‚     â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘            â”‚
â”‚                           â”‚
â”‚  â¸ï¸ 3. åˆ†æä¸šåŠ¡: æ”¯ä»˜å¤„ç†   â”‚
â”‚     ç­‰å¾…æ‰§è¡Œ               â”‚
â”‚                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è¿›åº¦: 1/3 å®Œæˆ            â”‚
â”‚  é¢„è®¡å‰©ä½™: 3åˆ†é’Ÿ            â”‚
â”‚  [æš‚åœ] [è·³è¿‡å½“å‰]         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### çŠ¶æ€å›¾æ ‡å®šä¹‰
| çŠ¶æ€ | å›¾æ ‡ | é¢œè‰² |
|-----|------|------|
| pending | â¸ï¸ | ç°è‰² |
| in_progress | ğŸ”„ | è“è‰² + è¿›åº¦æ¡ |
| completed | âœ… | ç»¿è‰² |
| failed | âŒ | çº¢è‰² |
| skipped | â­ï¸ | ç°è‰²åˆ’çº¿ |

### 4.3 å³ä¾§æ—¶é—´çº¿é¢æ¿

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ• å·¥ä½œæµæ—¶é—´çº¿         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ â‘  éœ€æ±‚åˆ†æ      â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚ ğŸ”„ è¿›è¡Œä¸­ 35%   â”‚    â”‚
â”‚  â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘     â”‚    â”‚
â”‚  â”‚ 2/5 ä»»åŠ¡å®Œæˆ    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚         â†“              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ â‘¡ æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆ  â”‚    â”‚
â”‚  â”‚ â¸ï¸ å¾…æ‰§è¡Œ       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚         â†“              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ â‘¢ ç”¨ä¾‹è´¨é‡è¯„å®¡  â”‚    â”‚
â”‚  â”‚ â¸ï¸ å¾…æ‰§è¡Œ       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ€»è¿›åº¦: 1/3 é˜¶æ®µ       â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 12%   â”‚
â”‚  [æš‚åœå·¥ä½œæµ]           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. æŠ€æœ¯å®ç°æ–¹æ¡ˆ

### 5.1 æ ¸å¿ƒè®¾è®¡åŸåˆ™
1. **ä¸ä¾èµ–AIè‡ªè§‰æ€§**: ä½¿ç”¨å·¥å…·è°ƒç”¨ï¼ˆè€Œéç‰¹æ®Šæ ‡ç­¾ï¼‰
2. **å‰ç«¯æŒæ¡çŠ¶æ€çœŸç›¸**: ä»WebSocketäº‹ä»¶å’Œæ•°æ®åº“æŸ¥è¯¢çŠ¶æ€
3. **æ¸è¿›å¼ä¼˜åŒ–**: å…ˆå®ç°åŸºç¡€åŠŸèƒ½ï¼Œä¸ä¸€æ­¥åˆ°ä½

### 5.2 çŠ¶æ€ç®¡ç†æ¶æ„

```
å‰ç«¯React State
  â†• WebSocketå®æ—¶æ¨é€
åç«¯Tool + SQLite
  â†• Agentè°ƒç”¨å·¥å…·
AIæ‰§è¡Œä»»åŠ¡
```

**ä¼˜åŠ¿**:
- å·¥å…·è°ƒç”¨æœ‰schemaéªŒè¯ï¼Œå‚æ•°é”™è¯¯ç«‹å³å‘ç°
- æ•°æ®åº“æŒä¹…åŒ–ï¼Œåˆ·æ–°é¡µé¢çŠ¶æ€ä¸ä¸¢å¤±
- WebSocketå®æ—¶æ¨é€ï¼Œç”¨æˆ·ä½“éªŒæµç•…

### 5.3 Tokenç®¡ç†ç­–ç•¥

**ç¬¬ä¸€é˜¶æ®µï¼ˆæ·±åº¦åˆ†æï¼‰**: 10-15K tokens
- å…¨é‡åˆ†æéœ€æ±‚ã€ä¸šåŠ¡ã€ä»£ç 
- ç»“æœå­˜å…¥SQLite

**ç¬¬äºŒé˜¶æ®µï¼ˆæ–¹æ¡ˆç”Ÿæˆï¼‰**: 2-3K tokens
- è¯»å–ç¬¬ä¸€é˜¶æ®µæ‘˜è¦
- ä¸å†å¤§é‡è°ƒç”¨ä»£ç å·¥å…·

**ç¬¬ä¸‰é˜¶æ®µï¼ˆç”¨ä¾‹ç”Ÿæˆï¼‰**: 5-10K tokens
- åˆ†åŠŸèƒ½ç”Ÿæˆï¼Œæ¯åŠŸèƒ½1-2K
- é¿å…ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰åŠŸèƒ½

**æ€»è®¡**: 17-28K tokensï¼ˆå¯æ¥å—ï¼‰

---

## 6. æ•°æ®åº“è®¾è®¡

### 6.1 ä»»åŠ¡è¿½è¸ªè¡¨

```sql
CREATE TABLE test_task_board (
    id TEXT PRIMARY KEY,
    board_id TEXT NOT NULL,
    thread_id TEXT NOT NULL,
    phase TEXT NOT NULL,
    task_id TEXT NOT NULL,
    title TEXT NOT NULL,
    status TEXT NOT NULL,
    progress INTEGER DEFAULT 0,
    scope TEXT,
    result TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_thread (thread_id),
    INDEX idx_board (board_id)
);
```

### 6.2 é˜¶æ®µè¿›åº¦è¡¨

```sql
CREATE TABLE test_phase_progress (
    id TEXT PRIMARY KEY,
    thread_id TEXT NOT NULL,
    phase TEXT NOT NULL,
    status TEXT NOT NULL,
    progress INTEGER DEFAULT 0,
    tasks_total INTEGER DEFAULT 0,
    tasks_completed INTEGER DEFAULT 0,
    estimated_duration INTEGER,
    start_time TIMESTAMP,
    end_time TIMESTAMP,
    outputs TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_thread (thread_id),
    UNIQUE (thread_id, phase)
);
```

### 6.3 ä¼šè¯åˆ†æç¼“å­˜è¡¨

```sql
CREATE TABLE test_session_analysis (
    id TEXT PRIMARY KEY,
    thread_id TEXT NOT NULL,
    requirement_id TEXT,
    phase TEXT,
    scope TEXT,
    analysis_type TEXT,
    content TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_thread (thread_id),
    INDEX idx_scope (thread_id, scope)
);
```

---

## 7. åç«¯å®ç°

### 7.1 Coding APIæ‰©å±•

éœ€è¦åœ¨ `backend/app/api/v1/coding.py` æ–°å¢ä»¥ä¸‹æ¥å£ï¼š

```python
@router.get("/projects")
async def get_projects()

@router.get("/iterations")
async def get_iterations(project_name: str)

@router.get("/iteration/{iteration_id}/issues")
async def get_iteration_issues(iteration_id: str)

@router.get("/testing/config-options")
async def get_testing_config_options()
```

åŒæ—¶æ‰©å±• `CodingService`:
- `get_all_projects()`
- `get_project_iterations(project_name)`
- `get_iteration_issues(iteration_id)`

### 7.2 æµ‹è¯•å·¥å…·é›†

åœ¨ `backend/app/llm/langchain/tools/testing.py` æ–°å»ºæ–‡ä»¶ï¼Œå®ç°ä»¥ä¸‹å·¥å…·ï¼š

**ä»»åŠ¡ç®¡ç†å·¥å…·**:
- `create_task_board(thread_id, phase, tasks)`: åˆ›å»ºä»»åŠ¡çœ‹æ¿
- `update_task_status(thread_id, task_id, status, progress, result)`: æ›´æ–°ä»»åŠ¡çŠ¶æ€
- `transition_to_phase(thread_id, from_phase, to_phase)`: åˆ‡æ¢é˜¶æ®µ

**CodingæŸ¥è¯¢å·¥å…·**:
- `get_coding_issue_detail(project_name, issue_code)`: è·å–éœ€æ±‚è¯¦æƒ…

**æ‘˜è¦ç®¡ç†å·¥å…·**:
- `save_phase_summary(thread_id, phase, summary)`: ä¿å­˜é˜¶æ®µæ‘˜è¦
- `get_phase_summary(thread_id, phase)`: è·å–é˜¶æ®µæ‘˜è¦

**å…³é”®å®ç°ç»†èŠ‚**:
1. å·¥å…·å‡½æ•°å†…éƒ¨å®Œæˆæ•°æ®åº“æ“ä½œ
2. é€šè¿‡WebSocketæ¨é€æ¶ˆæ¯åˆ°å‰ç«¯
3. è¿”å›ç®€æ´çš„ç¡®è®¤æ¶ˆæ¯ç»™AI

### 7.3 WebSocketæ¨é€æœºåˆ¶

å¤ç”¨ç°æœ‰çš„ `backend/app/api/v1/llm_chat.py` ä¸­çš„ `manager`ï¼š

```python
from backend.app.api.v1.llm_chat import manager
import asyncio

# åœ¨å·¥å…·ä¸­æ¨é€æ¶ˆæ¯
asyncio.create_task(manager.send_to_thread(thread_id, {
    "type": "task_board_created",
    "data": {...}
}))
```

### 7.4 Agenté…ç½®

åœ¨ `backend/app/llm/langchain/configs.py` æ–°å¢ï¼š

```python
AGENT_CONFIGS = {
    # ... ç°æœ‰Agent ...
    
    "intelligent_testing": AgentConfig(
        agent_type="intelligent_testing",
        name="æ™ºèƒ½æµ‹è¯•åŠ©æ‰‹",
        description="åŸºäºCodingéœ€æ±‚å’Œä»£ç ï¼Œç”Ÿæˆæµ‹è¯•æ–¹æ¡ˆã€ç”¨ä¾‹å’Œè¯„å®¡",
        system_prompt=INTELLIGENT_TESTING_PROMPT,
        tools_factory=get_intelligent_testing_tools,
        model_call_limit=50,
        tool_call_limit=50,
        tags=["æµ‹è¯•", "è´¨é‡ä¿éšœ", "Codingé›†æˆ"],
    ),
}
```

---

## 8. å‰ç«¯å®ç°

### 8.1 ç»„ä»¶ç»“æ„

```
TestingChatPage/
â”œâ”€â”€ TopConfigBar (é¡¶éƒ¨Codingé…ç½®)
â”‚   â”œâ”€â”€ ProjectSelector
â”‚   â”œâ”€â”€ IterationSelector
â”‚   â””â”€â”€ RequirementSelector
â”‚
â”œâ”€â”€ LeftTaskPanel (å·¦ä¾§ä»»åŠ¡çœ‹æ¿ï¼Œå›ºå®šæ‚¬æµ®)
â”‚   â”œâ”€â”€ TaskList
â”‚   â”œâ”€â”€ TaskItem
â”‚   â”‚   â”œâ”€â”€ TaskTitle
â”‚   â”‚   â”œâ”€â”€ TaskProgress
â”‚   â”‚   â””â”€â”€ TaskSubtasks
â”‚   â””â”€â”€ PanelControls
â”‚
â”œâ”€â”€ MiddleChatArea (ä¸­é—´å¯¹è¯åŒºï¼Œå¤ç”¨ç°æœ‰)
â”‚   â”œâ”€â”€ MessageList
â”‚   â”œâ”€â”€ ThinkingBlock
â”‚   â”œâ”€â”€ ToolCallCard
â”‚   â””â”€â”€ PhaseDivider (æ–°å¢ï¼šé˜¶æ®µåˆ†éš”çº¿)
â”‚
â””â”€â”€ RightTimelinePanel (å³ä¾§æ—¶é—´çº¿ï¼Œå›ºå®š)
    â”œâ”€â”€ PhaseTimeline
    â”œâ”€â”€ PhaseItem
    â””â”€â”€ WorkflowControls
```

### 8.2 çŠ¶æ€ç®¡ç†Hooks

```typescript
// useTaskBoard.ts
export function useTaskBoard(threadId: string) {
  const [tasks, setTasks] = useState<Task[]>([]);
  const [boardId, setBoardId] = useState<string | null>(null);

  useEffect(() => {
    const ws = getWebSocket(threadId);
    
    ws.on('task_board_created', (data) => {
      setBoardId(data.board_id);
      setTasks(data.tasks);
    });
    
    ws.on('task_updated', (data) => {
      setTasks(prev => 
        prev.map(task => 
          task.id === data.task_id 
            ? { ...task, ...data }
            : task
        )
      );
    });
    
    return () => {
      ws.off('task_board_created');
      ws.off('task_updated');
    };
  }, [threadId]);

  return { tasks, boardId };
}

// usePhaseProgress.ts
export function usePhaseProgress(threadId: string) {
  const [phases, setPhases] = useState<Phase[]>([...]);
  const [currentPhase, setCurrentPhase] = useState<string>('analysis');

  useEffect(() => {
    const ws = getWebSocket(threadId);
    
    ws.on('phase_changed', (data) => {
      setCurrentPhase(data.to_phase);
      // æ›´æ–°é˜¶æ®µçŠ¶æ€
    });
    
    return () => ws.off('phase_changed');
  }, [threadId]);

  return { phases, currentPhase };
}
```

### 8.3 APIæ¥å£

```typescript
// api/testing.ts
export async function getTestingConfigOptions() {
  return apiClient.get('/api/v1/coding/testing/config-options');
}

export async function getProjects() {
  return apiClient.get('/api/v1/coding/projects');
}

export async function getIterations(projectName: string) {
  return apiClient.get('/api/v1/coding/iterations', { params: { project_name: projectName } });
}

export async function getIterationIssues(iterationId: string) {
  return apiClient.get(`/api/v1/coding/iteration/${iterationId}/issues`);
}
```

---

## 9. WebSocketæ¶ˆæ¯åè®®

### 9.1 ä»»åŠ¡çœ‹æ¿ç›¸å…³

```typescript
// ä»»åŠ¡çœ‹æ¿åˆ›å»º
{
  type: "task_board_created",
  board_id: string,
  phase: string,
  tasks: Array<{
    id: string,
    title: string,
    status: "pending",
    scope: string,
    progress: 0
  }>
}

// ä»»åŠ¡çŠ¶æ€æ›´æ–°
{
  type: "task_updated",
  task_id: string,
  status: "in_progress" | "completed" | "failed" | "skipped",
  progress?: number,
  result?: any
}
```

### 9.2 é˜¶æ®µåˆ‡æ¢ç›¸å…³

```typescript
// é˜¶æ®µåˆ‡æ¢
{
  type: "phase_changed",
  from_phase: string,
  to_phase: string,
  timestamp: string
}

// é˜¶æ®µè¿›åº¦æ›´æ–°
{
  type: "phase_progress",
  phase: string,
  progress: number,
  tasks_completed: number,
  tasks_total: number
}
```

---

## 10. Agent Promptè®¾è®¡

### 10.1 System Promptç»“æ„

```
# Roleå®šä¹‰
# Profile
# å½“å‰ä»»åŠ¡é…ç½®ï¼ˆåŠ¨æ€æ³¨å…¥ï¼‰
# å¯ç”¨ä»£ç åº“å·¥ä½œåŒºï¼ˆåŠ¨æ€æ³¨å…¥ï¼‰

# å·¥ä½œæµç¨‹è§„èŒƒ
## é˜¶æ®µ1ï¼šéœ€æ±‚åˆ†æ
### æ­¥éª¤1: åˆ›å»ºä»»åŠ¡æ¸…å•ï¼ˆå¿…é¡»è°ƒç”¨create_task_boardï¼‰
### æ­¥éª¤2: æ‰§è¡Œä»»åŠ¡ï¼ˆé€ä¸ªè°ƒç”¨update_task_statusï¼‰
### æ­¥éª¤3: ç”Ÿæˆé˜¶æ®µæ‘˜è¦ï¼ˆè°ƒç”¨save_phase_summaryï¼‰

## é˜¶æ®µ2ï¼šæµ‹è¯•æ–¹æ¡ˆç”Ÿæˆ
### æ­¥éª¤1: è·å–ä¸Šæ–‡æ‘˜è¦ï¼ˆè°ƒç”¨get_phase_summaryï¼‰
### æ­¥éª¤2: ç”Ÿæˆæ–¹æ¡ˆ
### æ­¥éª¤3: è¾“å‡ºæ–¹æ¡ˆ

## é˜¶æ®µ3ï¼šæµ‹è¯•ç”¨ä¾‹ç”Ÿæˆ
### æ­¥éª¤1: è·å–æ–¹æ¡ˆæ‘˜è¦
### æ­¥éª¤2: åˆ›å»ºç”¨ä¾‹ç”Ÿæˆä»»åŠ¡
### æ­¥éª¤3: åˆ†åŠŸèƒ½ç”Ÿæˆç”¨ä¾‹

# å·¥å…·ä½¿ç”¨è§„èŒƒ
## å¿…é¡»è°ƒç”¨çš„å·¥å…·ï¼ˆæ¯ä¸ªé˜¶æ®µï¼‰
## å·¥å…·è°ƒç”¨é¡ºåº

# è¾“å‡ºè§„èŒƒ
## æ€è€ƒè¿‡ç¨‹å±•ç¤º
## é˜¶æ®µåˆ†éš”çº¿
## ç”¨ä¾‹æ ¼å¼
```

### 10.2 å…³é”®Promptç‰‡æ®µ

**å¼ºåˆ¶å·¥å…·è°ƒç”¨**:
```
### é˜¶æ®µå¼€å§‹æ—¶ï¼ˆå¿…é¡»æ‰§è¡Œï¼‰
1. åˆ†æéœ€æ±‚ï¼Œç¡®å®šéœ€è¦å®Œæˆçš„ä»»åŠ¡æ¸…å•
2. **ç«‹å³è°ƒç”¨** create_task_board() å·¥å…·åˆ›å»ºä»»åŠ¡çœ‹æ¿
3. ç„¶åå¼€å§‹æ‰§è¡Œä»»åŠ¡

âš ï¸ é‡è¦ï¼šä¸è¦åœ¨æ¶ˆæ¯ä¸­è¾“å‡ºä»»åŠ¡æ¸…å•ï¼Œå·¥å…·ä¼šè‡ªåŠ¨é€šçŸ¥å‰ç«¯æ¸²æŸ“
```

**ä»»åŠ¡æ‰§è¡Œè§„èŒƒ**:
```
å¯¹äºæ¯ä¸ªä»»åŠ¡ï¼š
1. è°ƒç”¨ update_task_status(task_id, "in_progress") æ ‡è®°å¼€å§‹
2. æ‰§è¡Œä»»åŠ¡ï¼ˆè°ƒç”¨ç›¸åº”å·¥å…·ã€åˆ†æä»£ç ï¼‰
3. è°ƒç”¨ update_task_status(task_id, "completed", result=...) æ ‡è®°å®Œæˆ
```

**é˜¶æ®µåˆ‡æ¢è§„èŒƒ**:
```
æ‰€æœ‰ä»»åŠ¡å®Œæˆåï¼š
1. æ€»ç»“åˆ†æç»“æœ
2. è°ƒç”¨ save_phase_summary() ä¿å­˜å‹ç¼©æ‘˜è¦
3. è°ƒç”¨ transition_to_phase(from_phase="analysis", to_phase="plan")
4. è¾“å‡ºé˜¶æ®µåˆ†éš”çº¿å’Œæ‘˜è¦æŠ¥å‘Š
```

---

## 11. å¼€å‘è®¡åˆ’

### 11.1 Phase 1: åŸºç¡€æ¡†æ¶ï¼ˆ5å¤©ï¼‰

**Day 1-2: åç«¯åŸºç¡€**
- [ ] åˆ›å»ºæ•°æ®åº“è¡¨ï¼ˆ3å¼ è¡¨ï¼‰
- [ ] å®ç°Coding APIæ‰©å±•ï¼ˆ4ä¸ªæ¥å£ï¼‰
- [ ] å®ç°æµ‹è¯•å·¥å…·é›†ï¼ˆ6ä¸ªå·¥å…·ï¼‰
- [ ] é…ç½®Agentï¼ˆsystem prompt + tools factoryï¼‰

**Day 3-4: å‰ç«¯UI**
- [ ] åˆ›å»ºTestingConfigBarç»„ä»¶
- [ ] å®ç°LeftTaskPanelç»„ä»¶
- [ ] å®ç°RightTimelinePanelç»„ä»¶
- [ ] é›†æˆWebSocketç›‘å¬

**Day 5: è”è°ƒæµ‹è¯•**
- [ ] ç«¯åˆ°ç«¯æµç¨‹æµ‹è¯•
- [ ] å·¥å…·è°ƒç”¨éªŒè¯
- [ ] WebSocketæ¨é€æµ‹è¯•

### 11.2 Phase 2: åŠŸèƒ½å®Œå–„ï¼ˆ5å¤©ï¼‰

**Day 6-7: é˜¶æ®µ1å®ç°**
- [ ] å®Œå–„éœ€æ±‚åˆ†æPrompt
- [ ] ä¼˜åŒ–ä»»åŠ¡æ‹†åˆ†é€»è¾‘
- [ ] æµ‹è¯•ä¸šåŠ¡æµç¨‹åˆ†æ

**Day 8-9: é˜¶æ®µ2-3å®ç°**
- [ ] å®ç°æµ‹è¯•æ–¹æ¡ˆç”Ÿæˆ
- [ ] å®ç°ç”¨ä¾‹ç”Ÿæˆé€»è¾‘
- [ ] ä¼˜åŒ–ç”¨ä¾‹æ ¼å¼è¾“å‡º

**Day 10: ä¼˜åŒ–å’Œè°ƒè¯•**
- [ ] Promptå·¥ç¨‹ä¼˜åŒ–
- [ ] UIä½“éªŒä¼˜åŒ–
- [ ] é”™è¯¯å¤„ç†å®Œå–„

### 11.3 Phase 3: æµ‹è¯•ä¸ä¸Šçº¿ï¼ˆ3å¤©ï¼‰

**Day 11-12: æµ‹è¯•**
- [ ] åŠŸèƒ½æµ‹è¯•ï¼ˆ5ä¸ªå…¸å‹éœ€æ±‚ï¼‰
- [ ] æ€§èƒ½æµ‹è¯•ï¼ˆTokenæ¶ˆè€—ã€å“åº”æ—¶é—´ï¼‰
- [ ] è¾¹ç•Œæµ‹è¯•ï¼ˆé”™è¯¯å¤„ç†ã€ä¸­æ–­æ¢å¤ï¼‰

**Day 13: æ–‡æ¡£ä¸ä¸Šçº¿**
- [ ] ç”¨æˆ·ä½¿ç”¨æ–‡æ¡£
- [ ] éƒ¨ç½²ä¸Šçº¿
- [ ] å›¢é˜ŸåŸ¹è®­

### 11.4 å·¥ä½œé‡è¯„ä¼°

| æ¨¡å— | å·¥ä½œé‡ | è´Ÿè´£äºº |
|-----|-------|--------|
| åç«¯API | 3å¤© | åç«¯å¼€å‘ |
| åç«¯å·¥å…· | 3å¤© | åç«¯å¼€å‘ |
| å‰ç«¯UI | 5å¤© | å‰ç«¯å¼€å‘ |
| Promptå·¥ç¨‹ | 2å¤© | AIå·¥ç¨‹å¸ˆ |
| æµ‹è¯• | 3å¤© | æµ‹è¯•å·¥ç¨‹å¸ˆ |
| **æ€»è®¡** | **13-16å¤©** | - |

---

## é™„å½•

### A. å…³é”®æŠ€æœ¯å†³ç­–

| å†³ç­–ç‚¹ | é€‰é¡¹A | é€‰é¡¹B | æœ€ç»ˆé€‰æ‹© | ç†ç”± |
|-------|-------|-------|---------|------|
| çŠ¶æ€ç®¡ç† | ç‰¹æ®Šæ ‡ç­¾ | å·¥å…·è°ƒç”¨ | **å·¥å…·è°ƒç”¨** | å¯é æ€§é«˜ï¼Œæœ‰schemaéªŒè¯ |
| ä¸Šä¸‹æ–‡éš”ç¦» | LangGraph | å·¥å…·å‹ç¼© | **å·¥å…·å‹ç¼©** | æ— éœ€é‡æ„ç°æœ‰æ¶æ„ |
| å­˜å‚¨æ–¹æ¡ˆ | Neo4j | SQLite | **SQLite** | è½»é‡ã€å·²æœ‰ã€å¤Ÿç”¨ |
| UIå¸ƒå±€ | å¡ç‰‡äº¤äº’ | ä¸‰åŒºåŸŸå›ºå®š | **ä¸‰åŒºåŸŸå›ºå®š** | æ¸…æ™°ç›´è§‚ï¼Œå¼€å‘æˆæœ¬ä½ |

### B. é£é™©ä¸åº”å¯¹

| é£é™© | æ¦‚ç‡ | å½±å“ | åº”å¯¹æªæ–½ |
|-----|------|------|---------|
| AIä¸æŒ‰è§„èŒƒè°ƒç”¨å·¥å…· | ä¸­ | é«˜ | å¼ºåŒ–Promptå·¥ç¨‹ï¼Œå¤šæ¬¡æµ‹è¯•éªŒè¯ |
| Tokenè¶…é™ | ä½ | ä¸­ | æ‘˜è¦å‹ç¼©æœºåˆ¶ï¼Œåˆ†åŠŸèƒ½å¤„ç† |
| å‰ç«¯çŠ¶æ€åŒæ­¥å»¶è¿Ÿ | ä½ | ä½ | WebSocketå·²éªŒè¯ç¨³å®š |
| éœ€æ±‚å¤æ‚åº¦è¶…é¢„æœŸ | ä¸­ | ä¸­ | å…ˆæ”¯æŒç®€å•éœ€æ±‚ï¼Œé€æ­¥ä¼˜åŒ– |

### C. åç»­ä¼˜åŒ–æ–¹å‘

1. **ç”¨ä¾‹è¯„å®¡åŠŸèƒ½**: å½“å‰ä»…å®ç°ç”Ÿæˆï¼Œåç»­å¯å¢åŠ è¯„å®¡èƒ½åŠ›
2. **ç”¨ä¾‹ç¼–è¾‘åŠŸèƒ½**: æ”¯æŒåœ¨çº¿ç¼–è¾‘ç”Ÿæˆçš„ç”¨ä¾‹
3. **å†å²è®°å½•**: æ”¯æŒæŸ¥çœ‹å†å²ç”Ÿæˆçš„æ–¹æ¡ˆå’Œç”¨ä¾‹
4. **æ¨¡æ¿ç®¡ç†**: æ”¯æŒè‡ªå®šä¹‰ç”¨ä¾‹æ¨¡æ¿
5. **Excelå¯¼å‡º**: å¯¼å‡ºç”¨ä¾‹ä¸ºExcelæ ¼å¼

---

**æ–‡æ¡£ç»“æŸ**

å¦‚æœ‰ç–‘é—®ï¼Œè¯·è”ç³»é¡¹ç›®è´Ÿè´£äººã€‚
