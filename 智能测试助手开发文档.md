# æ™ºèƒ½æµ‹è¯•åŠ©æ‰‹ï¼ˆIntelligent Testing Agentï¼‰å¼€å‘æ–‡æ¡£

> **ç‰ˆæœ¬**: v2.1  
> **æ—¥æœŸ**: 2024-12-09  
> **çŠ¶æ€**: å¼€å‘ä¸­ï¼ˆåŸºç¡€æ¡†æ¶å·²å®Œæˆï¼‰  
> **æ›´æ–°è¯´æ˜**: åŸºäºæŠ€æœ¯è¯„å®¡ä¼˜åŒ–æ¶æ„ï¼Œé‡‡ç”¨ LangGraph çŠ¶æ€æœº + åˆ†é˜¶æ®µæ‘˜è¦å‹ç¼©æ–¹æ¡ˆ

---

## ç›®å½•

- [1. é¡¹ç›®èƒŒæ™¯](#1-é¡¹ç›®èƒŒæ™¯)
- [2. åŠŸèƒ½ç›®æ ‡](#2-åŠŸèƒ½ç›®æ ‡)
- [3. æ•´ä½“æ¶æ„](#3-æ•´ä½“æ¶æ„)
- [4. UIè®¾è®¡](#4-uiè®¾è®¡)
- [5. æŠ€æœ¯å®ç°æ–¹æ¡ˆ](#5-æŠ€æœ¯å®ç°æ–¹æ¡ˆ)
- [6. æ•°æ®åº“è®¾è®¡](#6-æ•°æ®åº“è®¾è®¡)
- [7. åç«¯å®ç°](#7-åç«¯å®ç°)
- [8. å‰ç«¯å®ç°](#8-å‰ç«¯å®ç°)
- [9. WebSocketæ¶ˆæ¯åè®®](#9-websocketæ¶ˆæ¯åè®®)
- [10. Agent Promptè®¾è®¡](#10-agent-promptè®¾è®¡)
- [11. å¼€å‘è®¡åˆ’](#11-å¼€å‘è®¡åˆ’)

---

## 1. é¡¹ç›®èƒŒæ™¯

### 1.1 ç°æœ‰èƒ½åŠ›

é¡¹ç›®å·²å…·å¤‡ä»¥ä¸‹åŸºç¡€èƒ½åŠ›ï¼Œå¯ä½œä¸ºæ™ºèƒ½æµ‹è¯•åŠ©æ‰‹çš„æ”¯æ’‘ï¼š

**Codingéœ€æ±‚æ–‡æ¡£æŸ¥è¯¢**
- `CodingService`: é›†æˆCodingå¹³å°OpenAPI
- æ”¯æŒè·å–éœ€æ±‚è¯¦æƒ…ã€å›¾ç‰‡æ›¿æ¢ã€PDFå¯¼å‡º
- API: `/api/v1/coding/issue/detail`

**å¤šæ¨¡æ€æ–‡æ¡£è§£æ**
- `document_parser.py`: æ”¯æŒPDFã€DOCXã€Excelã€CSVç­‰æ ¼å¼
- æŒ‰é¡µæå–æ–‡æœ¬å’Œå›¾ç‰‡ï¼Œä¿ç•™ç»“æ„å…³ç³»
- å›¾ç‰‡è‡ªåŠ¨ä¸Šä¼ OSS

**ä¸šåŠ¡ç†è§£ä¸ä»£ç æŸ¥è¯¢**
- 16ä¸ªçŸ¥è¯†å›¾è°±å·¥å…·ï¼ˆä¸šåŠ¡æµç¨‹ã€æ¥å£ã€æ•°æ®èµ„æºï¼‰
- 5ä¸ªä»£ç æ£€ç´¢å·¥å…·ï¼ˆMCPè¯­ä¹‰æœç´¢ã€grepã€æ–‡ä»¶è¯»å–ï¼‰
- Neo4jå›¾æ•°æ®åº“æ”¯æŒ

**å¤šAgentæ¶æ„**
- AgentRegistryå•ä¾‹ç®¡ç†
- æ”¯æŒknowledge_qaã€log_troubleshootä¸¤ç§Agent
- LangChain + AsyncSqliteSaverå®ç°ä¼šè¯ç®¡ç†

**WebSocketå®æ—¶æ¨é€ï¼ˆå¯å¤ç”¨ï¼‰**
- `chat_service.py` å·²å®ç°å®Œæ•´çš„å·¥å…·è°ƒç”¨äº‹ä»¶æ¨é€
- `tool_start` / `tool_end` äº‹ä»¶æœºåˆ¶æˆç†Ÿç¨³å®š
- æ”¯æŒæ‰¹é‡å·¥å…·è°ƒç”¨çš„æ‰¹æ¬¡æ ‡è¯†

### 1.2 ä¸šåŠ¡éœ€æ±‚

æµ‹è¯•å›¢é˜Ÿé¢ä¸´çš„ç—›ç‚¹ï¼š
- äººå·¥ç¼–å†™æ•ˆç‡ä½ï¼šä¸€ä¸ªéœ€æ±‚éœ€è¦50+ç”¨ä¾‹ï¼Œè€—æ—¶2-3å¤©
- è¦†ç›–ç‡éš¾ä¿è¯ï¼šå®¹æ˜“é—æ¼è¾¹ç•Œåœºæ™¯å’Œå¼‚å¸¸åˆ†æ”¯
- ä»£ç ç†è§£æˆæœ¬é«˜ï¼šæµ‹è¯•äººå‘˜ä¸ç†Ÿæ‚‰ä»£ç å®ç°ç»†èŠ‚
- ç»´æŠ¤æˆæœ¬é«˜ï¼šéœ€æ±‚å˜æ›´åç”¨ä¾‹æ›´æ–°æ»å

### 1.3 è§£å†³æ–¹æ¡ˆ

æ„å»ºæ™ºèƒ½æµ‹è¯•åŠ©æ‰‹Agentï¼Œæ”¯æŒä¸‰ä¸ªé€’è¿›é˜¶æ®µï¼š
1. **éœ€æ±‚åˆ†æä¸ç†è§£**: åŸºäºéœ€æ±‚æ–‡æ¡£å’Œä»£ç ï¼Œæ·±åº¦åˆ†æä¸šåŠ¡é€»è¾‘
2. **æµ‹è¯•æ–¹æ¡ˆç”Ÿæˆ**: åˆ¶å®šæµ‹è¯•èŒƒå›´ã€ç­–ç•¥å’Œé£é™©ç‚¹
3. **æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆ**: è‡ªåŠ¨ç”ŸæˆåŠŸèƒ½ã€è¾¹ç•Œã€å¼‚å¸¸ä¸‰ç±»ç”¨ä¾‹

---

## 2. åŠŸèƒ½ç›®æ ‡

### 2.1 æ ¸å¿ƒåŠŸèƒ½
- åŸºäºCodingéœ€æ±‚IDè‡ªåŠ¨åˆ†æéœ€æ±‚æ–‡æ¡£
- æ·±å…¥ç†è§£ä¸šåŠ¡æµç¨‹å’Œä»£ç å®ç°
- ç”Ÿæˆç»“æ„åŒ–æµ‹è¯•æ–¹æ¡ˆ
- è‡ªåŠ¨ç”Ÿæˆ50+ç»“æ„åŒ–æµ‹è¯•ç”¨ä¾‹
- æ™ºèƒ½è¯„å®¡ç”¨ä¾‹è´¨é‡å¹¶æä¾›ä¼˜åŒ–å»ºè®®

### 2.2 ç”¨æˆ·ä½“éªŒç›®æ ‡
- **å¯è§†åŒ–ä»»åŠ¡è¿½è¸ª**: å·¦ä¾§é¢æ¿å®æ—¶å±•ç¤ºAIæ‰§è¡Œçš„ä»»åŠ¡åˆ—è¡¨
- **é˜¶æ®µåŒ–æ¨è¿›**: å³ä¾§æ—¶é—´çº¿æ¸…æ™°å±•ç¤ºä¸‰ä¸ªé˜¶æ®µçš„è¿›åº¦
- **é€æ˜åŒ–æ€è€ƒ**: ä¸­é—´å¯¹è¯åŒºå±•ç¤ºAIçš„æ€è€ƒè¿‡ç¨‹å’Œå·¥å…·è°ƒç”¨
- **å¯å¹²é¢„æ€§**: ç”¨æˆ·å¯æš‚åœã€è·³è¿‡ä»»åŠ¡ï¼Œéšæ—¶æŸ¥çœ‹ä¸­é—´äº§ç‰©

### 2.3 æŠ€æœ¯ç›®æ ‡
- é‡‡ç”¨ **LangGraph çŠ¶æ€æœº** å¼ºåˆ¶æ§åˆ¶ä¸‰é˜¶æ®µæµç¨‹ï¼Œé¿å… AI è·³è¿‡æˆ–ä¹±åº
- é‡‡ç”¨ **åˆ†é˜¶æ®µæ‘˜è¦å‹ç¼©** ç®¡ç† Tokenï¼Œæ¯ä¸ªé˜¶æ®µç‹¬ç«‹ thread_id
- å¤ç”¨ç°æœ‰ WebSocket çš„ `tool_start/tool_end` äº‹ä»¶æœºåˆ¶
- å¼€å‘å‘¨æœŸ: 10-16å¤©

---

## 3. æ•´ä½“æ¶æ„

### 3.1 ä¸‰é˜¶æ®µå·¥ä½œæµï¼ˆLangGraph çŠ¶æ€æœºæ§åˆ¶ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        LangGraph StateGraph                             â”‚
â”‚                                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚   â”‚   é˜¶æ®µ1       â”‚     â”‚   é˜¶æ®µ2       â”‚     â”‚   é˜¶æ®µ3       â”‚           â”‚
â”‚   â”‚  éœ€æ±‚åˆ†æ     â”‚â”€â”€â”€â”€â–¶â”‚  æ–¹æ¡ˆç”Ÿæˆ     â”‚â”€â”€â”€â”€â–¶â”‚  ç”¨ä¾‹ç”Ÿæˆ     â”‚â”€â”€â”€â–¶ END   â”‚
â”‚   â”‚  (thread_1)  â”‚     â”‚  (thread_2)  â”‚     â”‚  (thread_3)  â”‚           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚         â”‚                    â”‚                    â”‚                    â”‚
â”‚         â–¼                    â–¼                    â–¼                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚   â”‚  PHASE1_     â”‚     â”‚  PHASE2_     â”‚     â”‚  PHASE3_     â”‚           â”‚
â”‚   â”‚  PROMPT      â”‚     â”‚  PROMPT      â”‚     â”‚  PROMPT      â”‚           â”‚
â”‚   â”‚  + å…¨é‡å·¥å…·   â”‚     â”‚  + ç²¾ç®€å·¥å…·   â”‚     â”‚  + ç²¾ç®€å·¥å…·   â”‚           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é˜¶æ®µ1: éœ€æ±‚åˆ†æä¸ä¸šåŠ¡ç†è§£ (ç‹¬ç«‹ thread_1)
â”œâ”€ è§£æ Coding éœ€æ±‚æ–‡æ¡£
â”œâ”€ åˆ†æä¸šåŠ¡æµç¨‹ï¼ˆå¤šä¸ªåŠŸèƒ½æ¨¡å—ï¼‰
â”œâ”€ ä»£ç é€»è¾‘æ·±åº¦åˆ†æ
â”œâ”€ ç”Ÿæˆç»“æ„åŒ–æ‘˜è¦ â†’ å­˜å…¥ test_session_analysis è¡¨
â””â”€ Tokenæ¶ˆè€—: 10-15Kï¼ˆå·¥å…·è¿”å›å†…å®¹å¤šï¼‰

        â†“ [æ‘˜è¦ä¼ é€’ï¼Œå†å²æ¶ˆæ¯ä¸ä¼ é€’]

é˜¶æ®µ2: æµ‹è¯•æ–¹æ¡ˆç”Ÿæˆ (ç‹¬ç«‹ thread_2)
â”œâ”€ ä»æ•°æ®åº“è¯»å–é˜¶æ®µ1æ‘˜è¦ï¼ˆ~2K tokensï¼‰
â”œâ”€ åˆ¶å®šæµ‹è¯•èŒƒå›´å’Œç­–ç•¥
â”œâ”€ é£é™©ç‚¹åˆ†æ
â”œâ”€ ç”Ÿæˆæµ‹è¯•æ–¹æ¡ˆ â†’ å­˜å…¥ test_session_analysis è¡¨
â””â”€ Tokenæ¶ˆè€—: 2-3K

        â†“ [æ‘˜è¦ä¼ é€’ï¼Œå†å²æ¶ˆæ¯ä¸ä¼ é€’]

é˜¶æ®µ3: æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆ (ç‹¬ç«‹ thread_3)
â”œâ”€ ä»æ•°æ®åº“è¯»å–é˜¶æ®µ2æ–¹æ¡ˆæ‘˜è¦ï¼ˆ~3K tokensï¼‰
â”œâ”€ åˆ†åŠŸèƒ½ç”Ÿæˆç”¨ä¾‹
â”‚  â”œâ”€ åŠŸèƒ½ç”¨ä¾‹ï¼ˆæ­£å¸¸æµç¨‹ï¼‰
â”‚  â”œâ”€ è¾¹ç•Œç”¨ä¾‹ï¼ˆè¾¹ç•Œå€¼ï¼‰
â”‚  â””â”€ å¼‚å¸¸ç”¨ä¾‹ï¼ˆå¼‚å¸¸åˆ†æ”¯ï¼‰
â””â”€ Tokenæ¶ˆè€—: 5-10K

æ€»è®¡: 17-28K tokensï¼ˆåˆ†ä¸‰æ¬¡è¯·æ±‚ï¼Œé¿å… context çˆ†ç‚¸ï¼‰
```

### 3.2 å…³é”®è®¾è®¡ï¼šåˆ†é˜¶æ®µæ‘˜è¦å‹ç¼©

**é—®é¢˜**ï¼šå¦‚æœå…¨ç¨‹ä½¿ç”¨åŒä¸€ä¸ª thread_idï¼Œcheckpointer ä¼šç´¯ç§¯æ‰€æœ‰å†å²æ¶ˆæ¯ï¼ˆåŒ…æ‹¬å·¥å…·è¿”å›ï¼‰ï¼Œåˆ°é˜¶æ®µ3 å¯èƒ½è¶…è¿‡ 30K+ tokensã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ¯ä¸ªé˜¶æ®µä½¿ç”¨**ç‹¬ç«‹çš„ thread_id**
- é˜¶æ®µç»“æŸæ—¶ï¼ŒAI è°ƒç”¨ `save_phase_summary` å·¥å…·ï¼Œå°†å…³é”®ä¿¡æ¯å‹ç¼©æˆç»“æ„åŒ–æ‘˜è¦å­˜å…¥æ•°æ®åº“
- ä¸‹ä¸ªé˜¶æ®µå¼€å§‹æ—¶ï¼ŒAI è°ƒç”¨ `get_phase_summary` å·¥å…·è¯»å–ä¸Šé˜¶æ®µæ‘˜è¦ï¼Œæ³¨å…¥åˆ°æ–° context

**æ‘˜è¦å†…å®¹ç¤ºä¾‹ï¼ˆé˜¶æ®µ1è¾“å‡ºï¼‰**ï¼š
```markdown
## éœ€æ±‚åˆ†ææ‘˜è¦

### éœ€æ±‚æ¦‚è¿°
- éœ€æ±‚ID: #12345
- æ ¸å¿ƒåŠŸèƒ½: æœˆå¡å¼€é€š
- æ¶‰åŠæ¨¡å—: ç”¨æˆ·æœåŠ¡ã€æ”¯ä»˜æœåŠ¡ã€å¡æœåŠ¡

### ä¸šåŠ¡æµç¨‹
1. ç”¨æˆ·å‘èµ·å¼€å¡è¯·æ±‚
2. æ ¡éªŒç”¨æˆ·èµ„æ ¼ï¼ˆVIPç­‰çº§>=2ï¼Œæ— æ¬ è´¹ï¼‰
3. è°ƒç”¨æ”¯ä»˜æ¥å£
4. å¼€å¡å¹¶å‘é€é€šçŸ¥

### ä»£ç å…³é”®é€»è¾‘
- MonthCardService.openCard(): ä¸»å…¥å£
- æ ¡éªŒæ¡ä»¶: userLevel >= 2 AND balance >= 0
- å¼‚å¸¸åˆ†æ”¯: PaymentFailedException, UserNotQualifiedException
- æ•°æ®åº“æ“ä½œ: INSERT t_user_card, UPDATE t_user_balance

### æµ‹è¯•å…³æ³¨ç‚¹
- è¾¹ç•Œå€¼: userLevel=1/2/3, balance=0/-1/100
- å¼‚å¸¸åœºæ™¯: æ”¯ä»˜è¶…æ—¶ã€é‡å¤å¼€å¡ã€å¹¶å‘è¯·æ±‚
```

### 3.3 æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯é€‰å‹ | è¯´æ˜ |
|-----|---------|------|
| **æµç¨‹ç¼–æ’** | LangGraph StateGraph | å¼ºåˆ¶æ§åˆ¶ä¸‰é˜¶æ®µé¡ºåºæ‰§è¡Œ |
| **Agentæ¡†æ¶** | LangChain Agent + AsyncSqliteSaver | æ¯é˜¶æ®µå†…éƒ¨çš„ ReAct å·¥å…·è°ƒç”¨ |
| **æ‘˜è¦ç¼“å­˜** | SQLite (test_session_analysis è¡¨) | å­˜å‚¨é˜¶æ®µåˆ†æç»“æœï¼Œè·¨ thread ä¼ é€’ |
| **çŠ¶æ€ç®¡ç†** | WebSocket tool_start/tool_end + React State | å¤ç”¨ç°æœ‰äº‹ä»¶æœºåˆ¶ |
| **å‰ç«¯UI** | React + TypeScript + Ant Design | å¤ç”¨ç°æœ‰ç»„ä»¶åº“ |
| **å®æ—¶é€šä¿¡** | WebSocket | å¤ç”¨ç°æœ‰æ¨é€æœºåˆ¶ï¼Œæ— éœ€é¢å¤–æ¨é€é€»è¾‘ |

---

## 4. UIè®¾è®¡

### 4.1 æ•´ä½“å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é¡¶éƒ¨é…ç½®åŒºï¼š[Agent: æµ‹è¯•åŠ©æ‰‹â–¼] [é¡¹ç›®â–¼] [è¿­ä»£â–¼] [éœ€æ±‚â–¼] [å¼€å§‹ğŸš€] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            â”‚                                  â”‚                 â”‚
â”‚  å·¦ä¾§é¢æ¿   â”‚          ä¸­é—´å¯¹è¯åŒº               â”‚   å³ä¾§æ—¶é—´çº¿     â”‚
â”‚  (240px)   â”‚          (flex: 1)              â”‚   (280px)       â”‚
â”‚            â”‚                                  â”‚                 â”‚
â”‚  ä»»åŠ¡è¿½è¸ª   â”‚  â€¢ ç”¨æˆ·æ¶ˆæ¯                       â”‚  å·¥ä½œæµæ—¶é—´çº¿    â”‚
â”‚  çœ‹æ¿      â”‚  â€¢ AIæ€è€ƒè¿‡ç¨‹                     â”‚                 â”‚
â”‚  (å›ºå®š)    â”‚  â€¢ å·¥å…·è°ƒç”¨å¡ç‰‡                   â”‚  â‘  ğŸ”„ 35%     â”‚
â”‚            â”‚  â€¢ AIå›å¤                        â”‚  â‘¡ â¸ï¸         â”‚
â”‚  âœ… ä»»åŠ¡1   â”‚  â€¢ é˜¶æ®µåˆ†éš”çº¿                     â”‚  â‘¢ â¸ï¸         â”‚
â”‚  ğŸ”„ ä»»åŠ¡2   â”‚  â€¢ å…³é”®äº§ç‰©é«˜äº®                   â”‚                 â”‚
â”‚  â¸ï¸ ä»»åŠ¡3   â”‚                                  â”‚  æ€»è¿›åº¦: 12%   â”‚
â”‚            â”‚  (å¤ç”¨ç°æœ‰æ ·å¼)                   â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 å·¦ä¾§ä»»åŠ¡è¿½è¸ªé¢æ¿

#### é¢æ¿ç»“æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“‹ ä»»åŠ¡è¿½è¸ªçœ‹æ¿            â”‚
â”‚  éœ€æ±‚: #12345              â”‚
â”‚  é˜¶æ®µ: éœ€æ±‚åˆ†æ (1/3)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                           â”‚
â”‚  âœ… 1. è§£æéœ€æ±‚æ–‡æ¡£         â”‚
â”‚     â””â”€ æå–5ä¸ªåŠŸèƒ½ç‚¹        â”‚
â”‚                           â”‚
â”‚  ğŸ”„ 2. åˆ†æä¸šåŠ¡: æœˆå¡å¼€é€š   â”‚
â”‚     è¿›è¡Œä¸­... 40%          â”‚
â”‚     â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘            â”‚
â”‚                           â”‚
â”‚  â¸ï¸ 3. åˆ†æä¸šåŠ¡: æ”¯ä»˜å¤„ç†   â”‚
â”‚     ç­‰å¾…æ‰§è¡Œ               â”‚
â”‚                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è¿›åº¦: 1/3 å®Œæˆ            â”‚
â”‚  é¢„è®¡å‰©ä½™: 3åˆ†é’Ÿ            â”‚
â”‚  [æš‚åœ] [è·³è¿‡å½“å‰]         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### çŠ¶æ€å›¾æ ‡å®šä¹‰
| çŠ¶æ€ | å›¾æ ‡ | é¢œè‰² |
|-----|------|------|
| pending | â¸ï¸ | ç°è‰² |
| in_progress | ğŸ”„ | è“è‰² + è¿›åº¦æ¡ |
| completed | âœ… | ç»¿è‰² |
| failed | âŒ | çº¢è‰² |
| skipped | â­ï¸ | ç°è‰²åˆ’çº¿ |

### 4.3 å³ä¾§æ—¶é—´çº¿é¢æ¿

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ• å·¥ä½œæµæ—¶é—´çº¿         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ â‘  éœ€æ±‚åˆ†æ      â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚ ğŸ”„ è¿›è¡Œä¸­ 35%   â”‚    â”‚
â”‚  â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘     â”‚    â”‚
â”‚  â”‚ 2/5 ä»»åŠ¡å®Œæˆ    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚         â†“              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ â‘¡ æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆ  â”‚    â”‚
â”‚  â”‚ â¸ï¸ å¾…æ‰§è¡Œ       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚         â†“              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ â‘¢ ç”¨ä¾‹è´¨é‡è¯„å®¡  â”‚    â”‚
â”‚  â”‚ â¸ï¸ å¾…æ‰§è¡Œ       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ€»è¿›åº¦: 1/3 é˜¶æ®µ       â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 12%   â”‚
â”‚  [æš‚åœå·¥ä½œæµ]           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. æŠ€æœ¯å®ç°æ–¹æ¡ˆ

### 5.1 æ ¸å¿ƒè®¾è®¡åŸåˆ™
1. **LangGraph å¼ºåˆ¶æµç¨‹**ï¼šä½¿ç”¨çŠ¶æ€æœºæ§åˆ¶é˜¶æ®µåˆ‡æ¢ï¼ŒAI æ— æ³•è·³è¿‡æˆ–ä¹±åº
2. **å¤ç”¨ç°æœ‰äº‹ä»¶æœºåˆ¶**ï¼šé€šè¿‡ `tool_start/tool_end` äº‹ä»¶æ¨é€ä»»åŠ¡çŠ¶æ€ï¼Œæ— éœ€é¢å¤–æ¨é€é€»è¾‘
3. **æ‘˜è¦å‹ç¼©ä¼ é€’**ï¼šæ¯é˜¶æ®µç‹¬ç«‹ thread_idï¼Œé€šè¿‡æ•°æ®åº“å­˜å‚¨æ‘˜è¦è·¨é˜¶æ®µä¼ é€’

### 5.2 çŠ¶æ€ç®¡ç†æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          LangGraph StateGraph                           â”‚
â”‚                                                                         â”‚
â”‚   ç”¨æˆ·ç‚¹å‡»å¼€å§‹                                                           â”‚
â”‚        â†“                                                                â”‚
â”‚   analysis_node â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ plan_node â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ generate_node â”‚
â”‚        â”‚                           â”‚                           â”‚        â”‚
â”‚        â–¼                           â–¼                           â–¼        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚   â”‚ ReAct Agent â”‚            â”‚ ReAct Agent â”‚            â”‚ ReAct Agent â”‚â”‚
â”‚   â”‚ (thread_1)  â”‚            â”‚ (thread_2)  â”‚            â”‚ (thread_3)  â”‚â”‚
â”‚   â”‚ å¤šè½®å·¥å…·è°ƒç”¨ â”‚            â”‚ å¤šè½®å·¥å…·è°ƒç”¨ â”‚            â”‚ å¤šè½®å·¥å…·è°ƒç”¨ â”‚â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚          â”‚                          â”‚                          â”‚       â”‚
â”‚          â–¼                          â–¼                          â–¼       â”‚
â”‚   save_phase_summary         get_phase_summary          get_phase_summary
â”‚          â”‚                          â”‚                          â”‚       â”‚
â”‚          â–¼                          â–¼                          â–¼       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                    test_session_analysis è¡¨                      â”‚  â”‚
â”‚   â”‚   (æ‘˜è¦æŒä¹…åŒ–ï¼Œè·¨ thread ä¼ é€’)                                     â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å‰ç«¯çŠ¶æ€æ›´æ–°ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   chat_service.py                                                       â”‚
â”‚        â”‚                                                                â”‚
â”‚        â”œâ”€â”€ on_tool_start â”€â”€â–¶ WebSocket: { type: "tool_start", ... }    â”‚
â”‚        â”‚                           â”‚                                    â”‚
â”‚        â”‚                           â–¼                                    â”‚
â”‚        â”‚                     å‰ç«¯ç›‘å¬ tool_name:                         â”‚
â”‚        â”‚                     - create_task_board â†’ æ›´æ–°ä»»åŠ¡çœ‹æ¿          â”‚
â”‚        â”‚                     - update_task_status â†’ æ›´æ–°ä»»åŠ¡çŠ¶æ€         â”‚
â”‚        â”‚                     - transition_phase â†’ æ›´æ–°é˜¶æ®µè¿›åº¦           â”‚
â”‚        â”‚                                                                â”‚
â”‚        â””â”€â”€ on_tool_end â”€â”€â”€â”€â–¶ WebSocket: { type: "tool_end", ... }      â”‚
â”‚                                    â”‚                                    â”‚
â”‚                                    â–¼                                    â”‚
â”‚                              å‰ç«¯æ›´æ–°å·¥å…·å¡ç‰‡çŠ¶æ€                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¼˜åŠ¿**:
- LangGraph å¼ºåˆ¶æµç¨‹é¡ºåºï¼Œæ— éœ€ä¾èµ– AI "è‡ªè§‰æ€§"
- å¤ç”¨ç°æœ‰ `tool_start/tool_end` äº‹ä»¶ï¼Œå‰ç«¯é€šè¿‡ `tool_name` åŒºåˆ†å¤„ç†
- æ‘˜è¦å­˜æ•°æ®åº“ï¼Œåˆ·æ–°é¡µé¢å¯æ¢å¤çŠ¶æ€

### 5.3 Tokenç®¡ç†ç­–ç•¥

**åˆ†é˜¶æ®µç‹¬ç«‹ thread_id**ï¼š
- é˜¶æ®µ1 ä½¿ç”¨ `thread_1`ï¼Œç»“æŸæ—¶æ‘˜è¦å­˜å…¥æ•°æ®åº“
- é˜¶æ®µ2 ä½¿ç”¨ `thread_2`ï¼Œå¼€å§‹æ—¶è¯»å–é˜¶æ®µ1æ‘˜è¦ï¼ˆ~2Kï¼‰ï¼Œä¸æºå¸¦é˜¶æ®µ1çš„å·¥å…·è°ƒç”¨å†å²
- é˜¶æ®µ3 ä½¿ç”¨ `thread_3`ï¼Œå¼€å§‹æ—¶è¯»å–é˜¶æ®µ2æ‘˜è¦ï¼ˆ~3Kï¼‰

**Token æ¶ˆè€—ä¼°ç®—**ï¼š

| é˜¶æ®µ | è¾“å…¥ Token | å·¥å…·è°ƒç”¨ | è¾“å‡º Token | è¯´æ˜ |
|-----|-----------|---------|-----------|------|
| é˜¶æ®µ1 | ~2K (prompt + éœ€æ±‚) | 10-15æ¬¡ | ~15K | æ·±åº¦åˆ†æï¼Œå·¥å…·è¿”å›å¤š |
| é˜¶æ®µ2 | ~3K (prompt + æ‘˜è¦) | 2-3æ¬¡ | ~3K | è¯»æ‘˜è¦ï¼Œç”Ÿæˆæ–¹æ¡ˆ |
| é˜¶æ®µ3 | ~4K (prompt + æ–¹æ¡ˆ) | 5-10æ¬¡ | ~10K | åˆ†åŠŸèƒ½ç”Ÿæˆç”¨ä¾‹ |
| **æ€»è®¡** | **~9K** | **17-28æ¬¡** | **~28K** | åˆ†ä¸‰æ¬¡è¯·æ±‚ï¼Œå¯æ§ |

**ä¸å…¨é‡å†å²å¯¹æ¯”**ï¼š
- å…¨é‡å†å²æ–¹æ¡ˆï¼šé˜¶æ®µ3 è¾“å…¥å¯èƒ½è¾¾ 30K+ï¼Œæ¥è¿‘æ¨¡å‹ context ä¸Šé™
- æ‘˜è¦å‹ç¼©æ–¹æ¡ˆï¼šæ¯é˜¶æ®µè¾“å…¥æ§åˆ¶åœ¨ 5K ä»¥å†…ï¼Œæ¨¡å‹æ•ˆæœæ›´å¥½

---

## 6. æ•°æ®åº“è®¾è®¡

### 6.1 è®¾è®¡åŸåˆ™

**ç»Ÿä¸€æ–¹æ¡ˆ**ï¼šæ‰©å±•ç°æœ‰ `conversations` è¡¨ï¼Œæ–°å¢æµ‹è¯•åŠ©æ‰‹ä¸“ç”¨å­—æ®µï¼Œä¿æŒå†å²è®°å½•æŸ¥è¯¢çš„ç»Ÿä¸€æ€§ã€‚

**æ ¸å¿ƒæ€è·¯**ï¼š
- **æ™®é€šå¯¹è¯**ï¼š`id` å°±æ˜¯ `thread_id`ï¼Œæµ‹è¯•ä¸“ç”¨å­—æ®µä¸º null
- **æµ‹è¯•ä»»åŠ¡**ï¼š`id` æ˜¯ `session_id`ï¼Œé€šè¿‡ `thread_id_analysis/plan/generate` å…³è”ä¸‰ä¸ªé˜¶æ®µçš„æ¶ˆæ¯
- **æ‘˜è¦å­˜å‚¨**ï¼šæ–°å¢ `test_session_analysis` è¡¨å­˜å‚¨é˜¶æ®µé—´ä¼ é€’çš„æ‘˜è¦

**ä»»åŠ¡çœ‹æ¿çŠ¶æ€**ï¼šé€šè¿‡å‰ç«¯ React State + WebSocket `tool_start/tool_end` äº‹ä»¶ç®¡ç†ï¼Œæ— éœ€æŒä¹…åŒ–ã€‚

### 6.2 Conversation è¡¨æ‰©å±•ï¼ˆæ ¸å¿ƒæ”¹åŠ¨ï¼‰

æ‰©å±• `backend/app/models/chat.py` ä¸­çš„ `Conversation` æ¨¡å‹ï¼š

```python
class Conversation(Base):
    """ä¼šè¯å…ƒæ•°æ®è¡¨ï¼ˆç»Ÿä¸€å­˜å‚¨æ™®é€šå¯¹è¯å’Œæµ‹è¯•ä»»åŠ¡ï¼‰"""
    __tablename__ = "conversations"
    
    # ========== é€šç”¨å­—æ®µï¼ˆåŸæœ‰ï¼‰==========
    id = Column(String, primary_key=True, comment="æ™®é€šå¯¹è¯=thread_idï¼Œæµ‹è¯•ä»»åŠ¡=session_id")
    title = Column(String, nullable=True, default="æ–°å¯¹è¯", comment="ä¼šè¯æ ‡é¢˜")
    agent_type = Column(String, nullable=True, default="knowledge_qa", comment="Agent ç±»å‹")
    created_at = Column(DateTime(timezone=True), default=utc_now)
    updated_at = Column(DateTime(timezone=True), default=utc_now, onupdate=utc_now)
    
    # ========== æµ‹è¯•åŠ©æ‰‹ä¸“ç”¨å­—æ®µï¼ˆæ–°å¢ï¼Œå…¶ä»– agent ä¸º nullï¼‰==========
    requirement_id = Column(String, nullable=True, comment="Coding éœ€æ±‚ ID")
    project_name = Column(String, nullable=True, comment="Coding é¡¹ç›®åç§°")
    status = Column(String, nullable=True, comment="æµ‹è¯•ä»»åŠ¡çŠ¶æ€: pending/analysis/plan/generate/completed/failed")
    current_phase = Column(String, nullable=True, comment="å½“å‰é˜¶æ®µ: analysis/plan/generate")
    thread_id_analysis = Column(String, nullable=True, comment="é˜¶æ®µ1 éœ€æ±‚åˆ†æ thread_id")
    thread_id_plan = Column(String, nullable=True, comment="é˜¶æ®µ2 æ–¹æ¡ˆç”Ÿæˆ thread_id")
    thread_id_generate = Column(String, nullable=True, comment="é˜¶æ®µ3 ç”¨ä¾‹ç”Ÿæˆ thread_id")
```

**å­—æ®µè¯´æ˜**ï¼š

| å­—æ®µ | ç±»å‹ | æ™®é€šå¯¹è¯ | æµ‹è¯•ä»»åŠ¡ | è¯´æ˜ |
|-----|------|---------|---------|------|
| `id` | TEXT | thread_id | session_id | ä¸»é”®ï¼Œå«ä¹‰éš agent_type å˜åŒ– |
| `title` | TEXT | å¯¹è¯æ ‡é¢˜ | "éœ€æ±‚#xxx æœˆå¡å¼€é€š" | æ˜¾ç¤ºåç§° |
| `agent_type` | TEXT | knowledge_qa ç­‰ | intelligent_testing | Agent ç±»å‹ |
| `requirement_id` | TEXT | null | "12345" | Coding éœ€æ±‚ç¼–å· |
| `project_name` | TEXT | null | "keytop-app" | Coding é¡¹ç›®å |
| `status` | TEXT | null | pending/analysis/... | ä»»åŠ¡çŠ¶æ€ |
| `current_phase` | TEXT | null | analysis/plan/generate | å½“å‰é˜¶æ®µ |
| `thread_id_analysis` | TEXT | null | UUID | é˜¶æ®µ1 thread |
| `thread_id_plan` | TEXT | null | UUID | é˜¶æ®µ2 thread |
| `thread_id_generate` | TEXT | null | UUID | é˜¶æ®µ3 thread |

### 6.3 å†å²è®°å½•æŸ¥è¯¢ä¸æ¢å¤

**æŸ¥è¯¢ç»Ÿä¸€**ï¼š
```python
# æŸ¥è¯¢æ‰€æœ‰å†å²ï¼ˆæŒ‰æ—¶é—´æ’åºï¼‰
conversations = db.query(Conversation).order_by(desc(Conversation.updated_at)).limit(50).all()

# æŒ‰ agent_type ç­›é€‰
testing_tasks = db.query(Conversation).filter(
    Conversation.agent_type == "intelligent_testing"
).order_by(desc(Conversation.updated_at)).all()
```

**å‰ç«¯å¤„ç†**ï¼š
```typescript
function handleConversationClick(conv: Conversation) {
  if (conv.agent_type === 'intelligent_testing') {
    // æµ‹è¯•ä»»åŠ¡ï¼šåŠ è½½ sessionï¼Œæ ¹æ® status/current_phase æ¢å¤è¿›åº¦
    loadTestSession(conv.id, conv.status, conv.current_phase);
  } else {
    // æ™®é€šå¯¹è¯ï¼šç›´æ¥åŠ è½½ thread
    loadChatThread(conv.id);
  }
}
```

**æ¢å¤é€»è¾‘**ï¼š
- `status = completed`ï¼šå±•ç¤ºæ‰€æœ‰ä¸‰ä¸ªé˜¶æ®µçš„ç»“æœï¼Œå¯åˆ‡æ¢æŸ¥çœ‹
- `status = analysis/plan/generate`ï¼šæ¢å¤åˆ°å½“å‰é˜¶æ®µï¼Œæ˜¾ç¤º"ç»§ç»­æ‰§è¡Œ"æˆ–"é‡æ–°å¼€å§‹"æŒ‰é’®
- `status = failed`ï¼šæ˜¾ç¤ºå¤±è´¥ä¿¡æ¯ï¼Œå…è®¸"é‡æ–°å¼€å§‹"

### 6.4 ä¼šè¯åˆ†æç¼“å­˜è¡¨ï¼ˆæ‘˜è¦å­˜å‚¨ï¼‰

```sql
CREATE TABLE test_session_analysis (
    id TEXT PRIMARY KEY,                    -- UUID
    session_id TEXT NOT NULL,               -- å¯¹åº” conversations.idï¼ˆæµ‹è¯•ä»»åŠ¡çš„ session_idï¼‰
    phase TEXT NOT NULL,                    -- é˜¶æ®µ: analysis / plan / generate
    analysis_type TEXT NOT NULL,            -- æ‘˜è¦ç±»å‹: requirement_summary / test_plan / test_cases
    content TEXT NOT NULL,                  -- JSON æ ¼å¼çš„æ‘˜è¦å†…å®¹
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- ç´¢å¼•
CREATE INDEX idx_session ON test_session_analysis(session_id);
CREATE INDEX idx_session_phase ON test_session_analysis(session_id, phase);
CREATE UNIQUE INDEX idx_session_type ON test_session_analysis(session_id, analysis_type);
```

### 6.5 analysis_type æšä¸¾

| ç±»å‹ | é˜¶æ®µ | è¯´æ˜ |
|-----|------|------|
| `requirement_summary` | é˜¶æ®µ1è¾“å‡º | éœ€æ±‚åˆ†ææ‘˜è¦ï¼ˆéœ€æ±‚æ¦‚è¿°ã€ä¸šåŠ¡æµç¨‹ã€ä»£ç é€»è¾‘ã€æµ‹è¯•å…³æ³¨ç‚¹ï¼‰ |
| `test_plan` | é˜¶æ®µ2è¾“å‡º | æµ‹è¯•æ–¹æ¡ˆï¼ˆæµ‹è¯•èŒƒå›´ã€ç­–ç•¥ã€é£é™©ç‚¹ã€ä¼˜å…ˆçº§ï¼‰ |
| `test_cases` | é˜¶æ®µ3è¾“å‡º | æµ‹è¯•ç”¨ä¾‹é›†ï¼ˆåŠŸèƒ½ç”¨ä¾‹ã€è¾¹ç•Œç”¨ä¾‹ã€å¼‚å¸¸ç”¨ä¾‹ï¼‰ |

### 6.5 content JSON ç»“æ„ç¤ºä¾‹

**requirement_summaryï¼ˆé˜¶æ®µ1è¾“å‡ºï¼‰**ï¼š
```json
{
  "requirement": {
    "id": "12345",
    "title": "æœˆå¡å¼€é€šåŠŸèƒ½",
    "modules": ["ç”¨æˆ·æœåŠ¡", "æ”¯ä»˜æœåŠ¡", "å¡æœåŠ¡"]
  },
  "business_flow": [
    {"step": 1, "name": "å‘èµ·å¼€å¡è¯·æ±‚", "description": "ç”¨æˆ·åœ¨ APP ç‚¹å‡»å¼€é€š"},
    {"step": 2, "name": "èµ„æ ¼æ ¡éªŒ", "description": "VIPç­‰çº§>=2ï¼Œæ— æ¬ è´¹"},
    {"step": 3, "name": "æ”¯ä»˜å¤„ç†", "description": "è°ƒç”¨æ”¯ä»˜æ¥å£"},
    {"step": 4, "name": "å¼€å¡ç¡®è®¤", "description": "å†™å…¥å¡è®°å½•ï¼Œå‘é€é€šçŸ¥"}
  ],
  "code_logic": {
    "entry_point": "MonthCardService.openCard()",
    "validations": ["userLevel >= 2", "balance >= 0"],
    "exceptions": ["PaymentFailedException", "UserNotQualifiedException"],
    "db_operations": ["INSERT t_user_card", "UPDATE t_user_balance"]
  },
  "test_focus": {
    "boundary_values": ["userLevel=1/2/3", "balance=0/-1/100"],
    "exception_scenarios": ["æ”¯ä»˜è¶…æ—¶", "é‡å¤å¼€å¡", "å¹¶å‘è¯·æ±‚"]
  }
}
```

**test_planï¼ˆé˜¶æ®µ2è¾“å‡ºï¼‰**ï¼š
```json
{
  "scope": {
    "in_scope": ["å¼€å¡ä¸»æµç¨‹", "æ”¯ä»˜é›†æˆ", "é€šçŸ¥å‘é€"],
    "out_scope": ["é€€æ¬¾æµç¨‹", "å¡å‡çº§"]
  },
  "strategy": {
    "functional": "è¦†ç›–æ­£å¸¸å¼€å¡æµç¨‹çš„æ‰€æœ‰æ­¥éª¤",
    "boundary": "é’ˆå¯¹æ ¡éªŒæ¡ä»¶çš„è¾¹ç•Œå€¼æµ‹è¯•",
    "exception": "æ¨¡æ‹Ÿå„ç±»å¼‚å¸¸åœºæ™¯"
  },
  "risks": [
    {"risk": "æ”¯ä»˜å›è°ƒå»¶è¿Ÿ", "mitigation": "è®¾ç½®è¶…æ—¶é‡è¯•æœºåˆ¶æµ‹è¯•"},
    {"risk": "å¹¶å‘å¼€å¡å†²çª", "mitigation": "å¹¶å‘åœºæ™¯å‹åŠ›æµ‹è¯•"}
  ],
  "priority": {
    "P0": ["å¼€å¡ä¸»æµç¨‹"],
    "P1": ["æ”¯ä»˜å¼‚å¸¸", "èµ„æ ¼æ ¡éªŒ"],
    "P2": ["é€šçŸ¥å‘é€å¤±è´¥"]
  }
}
```

---

## 7. åç«¯å®ç°

### 7.1 Coding APIæ‰©å±•

åœ¨ `backend/app/api/v1/coding.py` æ–°å¢ä»¥ä¸‹æ¥å£ï¼š

```python
@router.get("/projects")
async def get_projects():
    """è·å–æ‰€æœ‰é¡¹ç›®åˆ—è¡¨"""
    return await coding_service.get_all_projects()

@router.get("/projects/{project_name}/iterations")
async def get_iterations(project_name: str):
    """è·å–é¡¹ç›®ä¸‹çš„è¿­ä»£åˆ—è¡¨"""
    return await coding_service.get_project_iterations(project_name)

@router.get("/iterations/{iteration_id}/issues")
async def get_iteration_issues(iteration_id: str):
    """è·å–è¿­ä»£ä¸‹çš„éœ€æ±‚åˆ—è¡¨"""
    return await coding_service.get_iteration_issues(iteration_id)
```

åŒæ—¶æ‰©å±• `CodingService`ï¼ˆ`backend/app/services/coding_service.py`ï¼‰:
- `get_all_projects()` - è°ƒç”¨ Coding Open API è·å–é¡¹ç›®åˆ—è¡¨
- `get_project_iterations(project_name)` - è·å–é¡¹ç›®è¿­ä»£
- `get_iteration_issues(iteration_id)` - è·å–è¿­ä»£ä¸‹éœ€æ±‚

### 7.2 LangGraph çŠ¶æ€æœºå®ç°

> **æ³¨æ„**ï¼šä»¥ä¸‹ä»£ç åŸºäº LangGraph æœ€æ–°ç‰ˆæœ¬ APIï¼ˆlanggraph >= 0.2.0ï¼‰

æ–°å»º `backend/app/llm/langchain/testing_graph.py`ï¼š

```python
from typing import Annotated, List
from typing_extensions import TypedDict

from langgraph.graph import StateGraph, START, END
from langgraph.graph.message import add_messages
from langgraph.prebuilt import create_react_agent
from langgraph.checkpoint.sqlite.aio import AsyncSqliteSaver

from langchain_core.messages import BaseMessage, HumanMessage
from langchain_openai import ChatOpenAI

# ============ 1. çŠ¶æ€å®šä¹‰ ============
class TestingState(TypedDict):
    """æµ‹è¯•åŠ©æ‰‹çŠ¶æ€å®šä¹‰
    
    ä½¿ç”¨ Annotated + add_messages å®ç°æ¶ˆæ¯è‡ªåŠ¨è¿½åŠ 
    """
    # messages å­—æ®µä½¿ç”¨ add_messages reducerï¼ˆè‡ªåŠ¨è¿½åŠ è€Œéè¦†ç›–ï¼‰
    messages: Annotated[list, add_messages]
    
    # ä¼šè¯ä¿¡æ¯ï¼ˆæ™®é€šè¦†ç›–ï¼‰
    session_id: str
    requirement_id: str
    project_name: str
    
    # é˜¶æ®µæµè½¬
    current_phase: str
    
    # é˜¶æ®µé—´ä¼ é€’çš„æ‘˜è¦ï¼ˆä»æ•°æ®åº“è¯»å–åæ³¨å…¥ï¼‰
    analysis_summary: str
    test_plan: str
    test_cases: str
    
    # é”™è¯¯ä¿¡æ¯
    error: str


# ============ 2. èŠ‚ç‚¹å‡½æ•° ============
async def analysis_node(state: TestingState) -> dict:
    """é˜¶æ®µ1ï¼šéœ€æ±‚åˆ†æèŠ‚ç‚¹
    
    è¿”å›å€¼åªåŒ…å«éœ€è¦æ›´æ–°çš„å­—æ®µ
    """
    session_id = state["session_id"]
    requirement_id = state["requirement_id"]
    project_name = state["project_name"]
    
    # ä½¿ç”¨ LangGraph é¢„æ„å»ºçš„ create_react_agent
    agent = create_react_agent(
        model=ChatOpenAI(model="gpt-4o", temperature=0),
        tools=get_analysis_tools(),
        state_modifier=PHASE1_ANALYSIS_PROMPT.format(
            session_id=session_id,
            requirement_id=requirement_id,
            project_name=project_name,
        ),
    )
    
    # æ‰§è¡Œ Agentï¼ˆå†…éƒ¨è‡ªåŠ¨è¿›è¡Œå¤šè½® ReActï¼‰
    result = await agent.ainvoke({"messages": state["messages"]})
    
    # Agent æ‰§è¡Œå®Œåï¼Œä»æ•°æ®åº“è¯»å– AI ä¿å­˜çš„æ‘˜è¦
    summary = await get_phase_summary_from_db(session_id, "requirement_summary")
    
    # åªè¿”å›éœ€è¦æ›´æ–°çš„å­—æ®µ
    return {
        "messages": result["messages"],  # add_messages ä¼šè‡ªåŠ¨è¿½åŠ 
        "analysis_summary": summary,
        "current_phase": "plan",
    }


async def plan_node(state: TestingState) -> dict:
    """é˜¶æ®µ2ï¼šæ–¹æ¡ˆç”ŸæˆèŠ‚ç‚¹"""
    session_id = state["session_id"]
    
    # æ³¨å…¥ä¸Šé˜¶æ®µæ‘˜è¦åˆ° Prompt
    agent = create_react_agent(
        model=ChatOpenAI(model="gpt-4o", temperature=0),
        tools=get_plan_tools(),
        state_modifier=PHASE2_PLAN_PROMPT.format(
            session_id=session_id,
            analysis_summary=state["analysis_summary"],
        ),
    )
    
    # é˜¶æ®µ2 ä½¿ç”¨æ–°çš„æ¶ˆæ¯ï¼ˆä¸æºå¸¦é˜¶æ®µ1çš„å·¥å…·è°ƒç”¨å†å²ï¼‰
    initial_message = HumanMessage(content="è¯·åŸºäºéœ€æ±‚åˆ†ææ‘˜è¦ç”Ÿæˆæµ‹è¯•æ–¹æ¡ˆ")
    result = await agent.ainvoke({"messages": [initial_message]})
    
    plan = await get_phase_summary_from_db(session_id, "test_plan")
    
    return {
        "messages": result["messages"],
        "test_plan": plan,
        "current_phase": "generate",
    }


async def generate_node(state: TestingState) -> dict:
    """é˜¶æ®µ3ï¼šç”¨ä¾‹ç”ŸæˆèŠ‚ç‚¹"""
    session_id = state["session_id"]
    
    agent = create_react_agent(
        model=ChatOpenAI(model="gpt-4o", temperature=0),
        tools=get_generate_tools(),
        state_modifier=PHASE3_GENERATE_PROMPT.format(
            session_id=session_id,
            test_plan=state["test_plan"],
        ),
    )
    
    initial_message = HumanMessage(content="è¯·åŸºäºæµ‹è¯•æ–¹æ¡ˆç”Ÿæˆæµ‹è¯•ç”¨ä¾‹")
    result = await agent.ainvoke({"messages": [initial_message]})
    
    cases = await get_phase_summary_from_db(session_id, "test_cases")
    
    return {
        "messages": result["messages"],
        "test_cases": cases,
        "current_phase": "done",
    }


# ============ 3. æ„å»ºçŠ¶æ€å›¾ ============
def create_testing_graph(checkpointer=None):
    """åˆ›å»ºæµ‹è¯•åŠ©æ‰‹çŠ¶æ€æœº"""
    
    # åˆ›å»ºå›¾æ„å»ºå™¨
    graph_builder = StateGraph(TestingState)
    
    # æ·»åŠ èŠ‚ç‚¹
    graph_builder.add_node("analysis", analysis_node)
    graph_builder.add_node("plan", plan_node)
    graph_builder.add_node("generate", generate_node)
    
    # æ·»åŠ è¾¹ï¼ˆSTART æ˜¯æ–°ç‰ˆ APIï¼‰
    graph_builder.add_edge(START, "analysis")
    graph_builder.add_edge("analysis", "plan")
    graph_builder.add_edge("plan", "generate")
    graph_builder.add_edge("generate", END)
    
    # ç¼–è¯‘å›¾ï¼ˆå¯é€‰ä¼ å…¥ checkpointerï¼‰
    return graph_builder.compile(checkpointer=checkpointer)


# ============ 4. è¾…åŠ©å‡½æ•° ============
async def get_phase_summary_from_db(session_id: str, analysis_type: str) -> str:
    """ä»æ•°æ®åº“è¯»å–é˜¶æ®µæ‘˜è¦"""
    # å®é™…å®ç°ä¸­ä» test_session_analysis è¡¨æŸ¥è¯¢
    pass
```

### 7.2.1 æœåŠ¡å±‚è°ƒç”¨ï¼ˆå…³é”®ï¼ï¼‰

æ–°å»º `backend/app/services/testing_service.py`ï¼š

```python
import json
from fastapi import WebSocket

from backend.app.llm.langchain.testing_graph import create_testing_graph, TestingState
from langgraph.checkpoint.sqlite.aio import AsyncSqliteSaver


async def run_testing_workflow(
    session_id: str,
    requirement_id: str,
    project_name: str,
    websocket: WebSocket,
):
    """æ‰§è¡Œæµ‹è¯•åŠ©æ‰‹å·¥ä½œæµ
    
    å…³é”®ï¼šä½¿ç”¨ graph.astream_events() å®ç°æµå¼è¾“å‡º
    äº‹ä»¶æ ¼å¼ä¸ç°æœ‰ chat_service.py å®Œå…¨å…¼å®¹ï¼
    """
    
    # åˆ›å»º checkpointerï¼ˆå¤ç”¨ç°æœ‰çš„ SQLiteï¼‰
    async with AsyncSqliteSaver.from_conn_string("llm_checkpoints.db") as checkpointer:
        
        # åˆ›å»ºçŠ¶æ€å›¾
        graph = create_testing_graph(checkpointer=checkpointer)
        
        # åˆå§‹çŠ¶æ€
        initial_state: TestingState = {
            "messages": [{"role": "user", "content": f"å¼€å§‹åˆ†æéœ€æ±‚ #{requirement_id}"}],
            "session_id": session_id,
            "requirement_id": requirement_id,
            "project_name": project_name,
            "current_phase": "analysis",
            "analysis_summary": "",
            "test_plan": "",
            "test_cases": "",
            "error": "",
        }
        
        config = {"configurable": {"thread_id": session_id}}
        
        # ========== æ ¸å¿ƒï¼šä½¿ç”¨ astream_events æµå¼æ‰§è¡Œ ==========
        # äº‹ä»¶ç±»å‹ä¸ç°æœ‰ chat_service.py å®Œå…¨ä¸€è‡´ï¼
        async for event in graph.astream_events(initial_state, config, version="v2"):
            event_type = event.get("event")
            
            # ===== å·¥å…·å¼€å§‹äº‹ä»¶ =====
            if event_type == "on_tool_start":
                tool_name = event.get("name", "unknown")
                tool_input = event.get("data", {}).get("input", {})
                
                await websocket.send_text(json.dumps({
                    "type": "tool_start",
                    "tool_name": tool_name,
                    "tool_input": tool_input,
                }, ensure_ascii=False))
            
            # ===== å·¥å…·ç»“æŸäº‹ä»¶ =====
            elif event_type == "on_tool_end":
                tool_name = event.get("name", "unknown")
                tool_output = event.get("data", {}).get("output", "")
                
                await websocket.send_text(json.dumps({
                    "type": "tool_end",
                    "tool_name": tool_name,
                    "output_summary": str(tool_output)[:200],
                }, ensure_ascii=False))
            
            # ===== LLM æµå¼è¾“å‡º =====
            elif event_type == "on_chat_model_stream":
                chunk = event.get("data", {}).get("chunk")
                if chunk and hasattr(chunk, "content") and chunk.content:
                    await websocket.send_text(json.dumps({
                        "type": "stream",
                        "content": chunk.content,
                    }, ensure_ascii=False))
            
            # ===== é˜¶æ®µåˆ‡æ¢ï¼ˆè‡ªå®šä¹‰é€»è¾‘ï¼‰=====
            elif event_type == "on_chain_end":
                # å¯ä»¥åœ¨è¿™é‡Œæ£€æµ‹é˜¶æ®µåˆ‡æ¢
                output = event.get("data", {}).get("output", {})
                if isinstance(output, dict) and "current_phase" in output:
                    await websocket.send_text(json.dumps({
                        "type": "phase_changed",
                        "phase": output["current_phase"],
                    }, ensure_ascii=False))
        
        # å‘é€å®Œæˆæ¶ˆæ¯
        await websocket.send_text(json.dumps({
            "type": "result",
            "session_id": session_id,
            "status": "completed",
        }, ensure_ascii=False))
```

### 7.2.2 API è·¯ç”±

åœ¨ `backend/app/api/v1/testing.py` æ–°å¢ï¼š

```python
from fastapi import APIRouter, WebSocket
from backend.app.services.testing_service import run_testing_workflow

router = APIRouter(prefix="/testing", tags=["testing"])

@router.websocket("/generate")
async def testing_generate(websocket: WebSocket):
    """æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆ WebSocket ç«¯ç‚¹"""
    await websocket.accept()
    
    try:
        # æ¥æ”¶åˆå§‹é…ç½®
        config = await websocket.receive_json()
        
        await run_testing_workflow(
            session_id=config["session_id"],
            requirement_id=config["requirement_id"],
            project_name=config["project_name"],
            websocket=websocket,
        )
    except Exception as e:
        await websocket.send_text(json.dumps({
            "type": "error",
            "message": str(e),
        }))
    finally:
        await websocket.close()
```

### 7.3 æµ‹è¯•å·¥å…·é›†

åœ¨ `backend/app/llm/langchain/tools/testing.py` æ–°å»ºæ–‡ä»¶ï¼š

**ä»»åŠ¡ç®¡ç†å·¥å…·**ï¼ˆå‰ç«¯é€šè¿‡ tool_start/tool_end äº‹ä»¶ç›‘å¬ï¼‰:
```python
@tool
def create_task_board(phase: str, tasks: List[dict]) -> str:
    """åˆ›å»ºä»»åŠ¡çœ‹æ¿
    
    Args:
        phase: å½“å‰é˜¶æ®µ (analysis/plan/generate)
        tasks: ä»»åŠ¡åˆ—è¡¨ [{"id": "task_1", "title": "è§£æéœ€æ±‚æ–‡æ¡£", "scope": "requirement"}]
    
    Returns:
        ç¡®è®¤æ¶ˆæ¯
    """
    # å·¥å…·è¢«è°ƒç”¨æ—¶ï¼Œchat_service ä¼šè‡ªåŠ¨å‘é€ tool_start äº‹ä»¶
    # å‰ç«¯ç›‘å¬ tool_name="create_task_board"ï¼Œä» tool_input è·å– tasks åˆ—è¡¨
    return f"ä»»åŠ¡çœ‹æ¿å·²åˆ›å»ºï¼Œå…± {len(tasks)} ä¸ªä»»åŠ¡"

@tool
def update_task_status(task_id: str, status: str, progress: int = 0, result: str = "") -> str:
    """æ›´æ–°ä»»åŠ¡çŠ¶æ€
    
    Args:
        task_id: ä»»åŠ¡ID
        status: çŠ¶æ€ (in_progress/completed/failed/skipped)
        progress: è¿›åº¦ç™¾åˆ†æ¯” (0-100)
        result: ä»»åŠ¡ç»“æœæ‘˜è¦
    """
    # å‰ç«¯ç›‘å¬ tool_name="update_task_status"ï¼Œæ›´æ–°å¯¹åº”ä»»åŠ¡çŠ¶æ€
    return f"ä»»åŠ¡ {task_id} çŠ¶æ€å·²æ›´æ–°ä¸º {status}"
```

**æ‘˜è¦ç®¡ç†å·¥å…·**:
```python
@tool
def save_phase_summary(session_id: str, analysis_type: str, content: str) -> str:
    """ä¿å­˜é˜¶æ®µæ‘˜è¦åˆ°æ•°æ®åº“
    
    Args:
        session_id: æµ‹è¯•ä¼šè¯ID
        analysis_type: æ‘˜è¦ç±»å‹ (requirement_summary/test_plan/test_cases)
        content: JSONæ ¼å¼çš„æ‘˜è¦å†…å®¹
    """
    # å­˜å…¥ test_session_analysis è¡¨
    db.add(TestSessionAnalysis(
        session_id=session_id,
        analysis_type=analysis_type,
        content=content,
        ...
    ))
    return f"æ‘˜è¦å·²ä¿å­˜: {analysis_type}"

@tool
def get_phase_summary(session_id: str, analysis_type: str) -> str:
    """è·å–é˜¶æ®µæ‘˜è¦
    
    Args:
        session_id: æµ‹è¯•ä¼šè¯ID
        analysis_type: æ‘˜è¦ç±»å‹
    
    Returns:
        JSONæ ¼å¼çš„æ‘˜è¦å†…å®¹
    """
    record = db.query(TestSessionAnalysis).filter(...).first()
    return record.content if record else ""
```

**CodingæŸ¥è¯¢å·¥å…·**:
```python
@tool
def get_coding_issue_detail(project_name: str, issue_code: int) -> str:
    """è·å–Codingéœ€æ±‚è¯¦æƒ…
    
    Args:
        project_name: é¡¹ç›®åç§°
        issue_code: éœ€æ±‚ç¼–å·
    
    Returns:
        éœ€æ±‚è¯¦æƒ…ï¼ˆåç§°ã€æè¿°ã€å›¾ç‰‡ç­‰ï¼‰
    """
    issue = await coding_service.get_issue_detail(project_name, issue_code)
    return json.dumps(issue.dict(), ensure_ascii=False)
```

### 7.4 WebSocket äº‹ä»¶æœºåˆ¶ï¼ˆå¤ç”¨ç°æœ‰ï¼‰

**æ— éœ€é¢å¤–æ¨é€é€»è¾‘**ï¼Œ`chat_service.py` å·²å®ç°å®Œæ•´çš„å·¥å…·äº‹ä»¶æ¨é€ï¼š

```python
# chat_service.py ç°æœ‰é€»è¾‘ï¼ˆæ— éœ€ä¿®æ”¹ï¼‰

# å·¥å…·å¼€å§‹æ—¶è‡ªåŠ¨å‘é€
await websocket.send_text(json.dumps({
    "type": "tool_start",
    "tool_name": tool_name,        # å¦‚ "create_task_board"
    "tool_id": tool_placeholder_id,
    "tool_input": tool_args,       # å¦‚ {"phase": "analysis", "tasks": [...]}
    ...
}))

# å·¥å…·ç»“æŸæ—¶è‡ªåŠ¨å‘é€
await websocket.send_text(json.dumps({
    "type": "tool_end",
    "tool_name": tool_name,
    "tool_id": placeholder_id,
    "input_summary": input_summary,
    "output_summary": output_summary,
    ...
}))
```

**å‰ç«¯åªéœ€ç›‘å¬ç‰¹å®š tool_name**ï¼Œæ ¹æ® `tool_input` æ›´æ–° UI çŠ¶æ€ã€‚

### 7.5 Agent é…ç½®

åœ¨ `backend/app/llm/langchain/configs.py` æ–°å¢ä¸‰å¥— Promptï¼š

```python
# é˜¶æ®µ1: éœ€æ±‚åˆ†æ Prompt
PHASE1_ANALYSIS_PROMPT = """
# Role: éœ€æ±‚åˆ†æä¸“å®¶
...ï¼ˆè¯¦è§ç¬¬10èŠ‚ï¼‰
"""

# é˜¶æ®µ2: æ–¹æ¡ˆç”Ÿæˆ Prompt  
PHASE2_PLAN_PROMPT = """
# Role: æµ‹è¯•æ–¹æ¡ˆè®¾è®¡å¸ˆ

## ä¸Šä¸‹æ–‡
ä»¥ä¸‹æ˜¯éœ€æ±‚åˆ†æé˜¶æ®µçš„æ‘˜è¦ï¼š
{analysis_summary}
...
"""

# é˜¶æ®µ3: ç”¨ä¾‹ç”Ÿæˆ Prompt
PHASE3_GENERATE_PROMPT = """
# Role: æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆå™¨

## ä¸Šä¸‹æ–‡
ä»¥ä¸‹æ˜¯æµ‹è¯•æ–¹æ¡ˆï¼š
{test_plan}
...
"""
```

### 7.6 å·¥å…·åˆ†é…

| é˜¶æ®µ | å·¥å…·é›† | è¯´æ˜ |
|-----|-------|------|
| é˜¶æ®µ1 | å…¨é‡å·¥å…· | ä»£ç æœç´¢ã€çŸ¥è¯†å›¾è°±ã€æ–‡ä»¶è¯»å–ã€CodingæŸ¥è¯¢ã€æ‘˜è¦ä¿å­˜ |
| é˜¶æ®µ2 | ç²¾ç®€å·¥å…· | æ‘˜è¦è¯»å–ã€æ‘˜è¦ä¿å­˜ï¼ˆä¸éœ€è¦ä»£ç æœç´¢ï¼‰ |
| é˜¶æ®µ3 | ç²¾ç®€å·¥å…· | æ‘˜è¦è¯»å–ã€æ‘˜è¦ä¿å­˜ã€ä»»åŠ¡çŠ¶æ€æ›´æ–° |

---

## 8. å‰ç«¯å®ç°

### 8.1 ç»„ä»¶ç»“æ„

```
TestingChatPage/
â”œâ”€â”€ TopConfigBar (é¡¶éƒ¨Codingé…ç½®)
â”‚   â”œâ”€â”€ ProjectSelector (é¡¹ç›®ä¸‹æ‹‰)
â”‚   â”œâ”€â”€ IterationSelector (è¿­ä»£ä¸‹æ‹‰ï¼Œä¾èµ–é¡¹ç›®)
â”‚   â”œâ”€â”€ RequirementSelector (éœ€æ±‚ä¸‹æ‹‰ï¼Œä¾èµ–è¿­ä»£)
â”‚   â””â”€â”€ StartButton (å¼€å§‹æŒ‰é’®)
â”‚
â”œâ”€â”€ LeftTaskPanel (å·¦ä¾§ä»»åŠ¡çœ‹æ¿ï¼Œå›ºå®šæ‚¬æµ®)
â”‚   â”œâ”€â”€ PhaseHeader (å½“å‰é˜¶æ®µæ ‡é¢˜)
â”‚   â”œâ”€â”€ TaskList
â”‚   â”‚   â””â”€â”€ TaskItem (å•ä¸ªä»»åŠ¡)
â”‚   â”‚       â”œâ”€â”€ StatusIcon (çŠ¶æ€å›¾æ ‡)
â”‚   â”‚       â”œâ”€â”€ TaskTitle
â”‚   â”‚       â””â”€â”€ ProgressBar (è¿›åº¦æ¡ï¼Œä»… in_progress)
â”‚   â””â”€â”€ PanelFooter (è¿›åº¦ç»Ÿè®¡)
â”‚
â”œâ”€â”€ MiddleChatArea (ä¸­é—´å¯¹è¯åŒºï¼Œå¤ç”¨ç°æœ‰ ChatPage)
â”‚   â”œâ”€â”€ MessageList (æ¶ˆæ¯åˆ—è¡¨)
â”‚   â”œâ”€â”€ ToolCallCard (å·¥å…·è°ƒç”¨å¡ç‰‡ï¼Œå¤ç”¨ç°æœ‰)
â”‚   â””â”€â”€ PhaseDivider (é˜¶æ®µåˆ†éš”çº¿ï¼Œæ–°å¢)
â”‚
â””â”€â”€ RightTimelinePanel (å³ä¾§æ—¶é—´çº¿)
    â”œâ”€â”€ PhaseTimeline
    â”‚   â””â”€â”€ PhaseItem Ã— 3 (ä¸‰ä¸ªé˜¶æ®µ)
    â”‚       â”œâ”€â”€ PhaseIcon
    â”‚       â”œâ”€â”€ PhaseName
    â”‚       â”œâ”€â”€ PhaseStatus
    â”‚       â””â”€â”€ PhaseProgress
    â””â”€â”€ TotalProgress (æ€»è¿›åº¦)
```

### 8.2 çŠ¶æ€ç®¡ç† Hooksï¼ˆå¤ç”¨ tool_start/tool_end äº‹ä»¶ï¼‰

**æ ¸å¿ƒæ€è·¯**ï¼šå‰ç«¯ç›‘å¬ç°æœ‰çš„ `tool_start` / `tool_end` äº‹ä»¶ï¼Œæ ¹æ® `tool_name` åˆ¤æ–­æ˜¯å¦æ˜¯ä»»åŠ¡ç®¡ç†å·¥å…·ï¼Œä» `tool_input` æå–æ•°æ®æ›´æ–° UIã€‚

```typescript
// hooks/useTestingTaskBoard.ts
import { useState, useEffect } from 'react';

interface Task {
  id: string;
  title: string;
  status: 'pending' | 'in_progress' | 'completed' | 'failed' | 'skipped';
  progress: number;
  result?: string;
}

interface Phase {
  id: string;
  name: string;
  status: 'pending' | 'in_progress' | 'completed';
  progress: number;
  tasksCompleted: number;
  tasksTotal: number;
}

export function useTestingTaskBoard(onMessage: (msg: any) => void) {
  const [tasks, setTasks] = useState<Task[]>([]);
  const [currentPhase, setCurrentPhase] = useState<string>('analysis');
  const [phases, setPhases] = useState<Phase[]>([
    { id: 'analysis', name: 'éœ€æ±‚åˆ†æ', status: 'pending', progress: 0, tasksCompleted: 0, tasksTotal: 0 },
    { id: 'plan', name: 'æ–¹æ¡ˆç”Ÿæˆ', status: 'pending', progress: 0, tasksCompleted: 0, tasksTotal: 0 },
    { id: 'generate', name: 'ç”¨ä¾‹ç”Ÿæˆ', status: 'pending', progress: 0, tasksCompleted: 0, tasksTotal: 0 },
  ]);

  // å¤„ç† WebSocket æ¶ˆæ¯
  const handleMessage = (msg: any) => {
    // ç›‘å¬ tool_start äº‹ä»¶
    if (msg.type === 'tool_start') {
      const { tool_name, tool_input } = msg;
      
      // åˆ›å»ºä»»åŠ¡çœ‹æ¿
      if (tool_name === 'create_task_board') {
        const { phase, tasks: newTasks } = tool_input;
        setCurrentPhase(phase);
        setTasks(newTasks.map((t: any) => ({
          ...t,
          status: 'pending',
          progress: 0,
        })));
        // æ›´æ–°é˜¶æ®µçŠ¶æ€
        setPhases(prev => prev.map(p => 
          p.id === phase 
            ? { ...p, status: 'in_progress', tasksTotal: newTasks.length }
            : p
        ));
      }
      
      // æ›´æ–°ä»»åŠ¡çŠ¶æ€ï¼ˆå¼€å§‹ï¼‰
      if (tool_name === 'update_task_status') {
        const { task_id, status, progress } = tool_input;
        setTasks(prev => prev.map(task =>
          task.id === task_id
            ? { ...task, status, progress: progress || 0 }
            : task
        ));
      }
    }
    
    // ç›‘å¬ tool_end äº‹ä»¶
    if (msg.type === 'tool_end') {
      const { tool_name } = msg;
      
      // ä»»åŠ¡çŠ¶æ€æ›´æ–°å®Œæˆ
      if (tool_name === 'update_task_status') {
        // é‡æ–°è®¡ç®—é˜¶æ®µè¿›åº¦
        setTasks(prev => {
          const completed = prev.filter(t => t.status === 'completed').length;
          const total = prev.length;
          setPhases(phases => phases.map(p =>
            p.id === currentPhase
              ? { ...p, tasksCompleted: completed, progress: Math.round(completed / total * 100) }
              : p
          ));
          return prev;
        });
      }
      
      // é˜¶æ®µæ‘˜è¦ä¿å­˜å®Œæˆ = é˜¶æ®µç»“æŸ
      if (tool_name === 'save_phase_summary') {
        setPhases(prev => prev.map(p =>
          p.id === currentPhase
            ? { ...p, status: 'completed', progress: 100 }
            : p
        ));
      }
    }
  };

  return { 
    tasks, 
    phases, 
    currentPhase, 
    handleMessage,
  };
}
```

### 8.3 API æ¥å£

```typescript
// api/coding.ts
import { apiClient } from './client';

// è·å–é¡¹ç›®åˆ—è¡¨
export async function getProjects() {
  return apiClient.get<Project[]>('/api/v1/coding/projects');
}

// è·å–é¡¹ç›®ä¸‹çš„è¿­ä»£åˆ—è¡¨
export async function getIterations(projectName: string) {
  return apiClient.get<Iteration[]>(`/api/v1/coding/projects/${projectName}/iterations`);
}

// è·å–è¿­ä»£ä¸‹çš„éœ€æ±‚åˆ—è¡¨
export async function getIterationIssues(iterationId: string) {
  return apiClient.get<Issue[]>(`/api/v1/coding/iterations/${iterationId}/issues`);
}

// ç±»å‹å®šä¹‰
interface Project {
  id: string;
  name: string;
  displayName: string;
}

interface Iteration {
  id: string;
  name: string;
  status: string;
}

interface Issue {
  code: number;
  name: string;
  type: string;
  status: string;
}
```

### 8.4 çº§è”é€‰æ‹©å™¨å®ç°

```typescript
// components/TopConfigBar.tsx
import { useState, useEffect } from 'react';
import { Select, Button, Space } from 'antd';
import { getProjects, getIterations, getIterationIssues } from '@/api/coding';

export function TopConfigBar({ onStart }: { onStart: (config: TestConfig) => void }) {
  const [projects, setProjects] = useState<Project[]>([]);
  const [iterations, setIterations] = useState<Iteration[]>([]);
  const [issues, setIssues] = useState<Issue[]>([]);
  
  const [selectedProject, setSelectedProject] = useState<string>();
  const [selectedIteration, setSelectedIteration] = useState<string>();
  const [selectedIssue, setSelectedIssue] = useState<number>();

  // åŠ è½½é¡¹ç›®åˆ—è¡¨
  useEffect(() => {
    getProjects().then(setProjects);
  }, []);

  // é¡¹ç›®å˜åŒ– â†’ åŠ è½½è¿­ä»£
  useEffect(() => {
    if (selectedProject) {
      setSelectedIteration(undefined);
      setSelectedIssue(undefined);
      getIterations(selectedProject).then(setIterations);
    }
  }, [selectedProject]);

  // è¿­ä»£å˜åŒ– â†’ åŠ è½½éœ€æ±‚
  useEffect(() => {
    if (selectedIteration) {
      setSelectedIssue(undefined);
      getIterationIssues(selectedIteration).then(setIssues);
    }
  }, [selectedIteration]);

  const handleStart = () => {
    if (selectedProject && selectedIssue) {
      onStart({
        projectName: selectedProject,
        issueCode: selectedIssue,
      });
    }
  };

  return (
    <Space>
      <Select
        placeholder="é€‰æ‹©é¡¹ç›®"
        value={selectedProject}
        onChange={setSelectedProject}
        options={projects.map(p => ({ label: p.displayName, value: p.name }))}
        style={{ width: 200 }}
      />
      <Select
        placeholder="é€‰æ‹©è¿­ä»£"
        value={selectedIteration}
        onChange={setSelectedIteration}
        options={iterations.map(i => ({ label: i.name, value: i.id }))}
        disabled={!selectedProject}
        style={{ width: 200 }}
      />
      <Select
        placeholder="é€‰æ‹©éœ€æ±‚"
        value={selectedIssue}
        onChange={setSelectedIssue}
        options={issues.map(i => ({ label: `#${i.code} ${i.name}`, value: i.code }))}
        disabled={!selectedIteration}
        style={{ width: 300 }}
      />
      <Button 
        type="primary" 
        onClick={handleStart}
        disabled={!selectedIssue}
      >
        å¼€å§‹ç”Ÿæˆ ğŸš€
      </Button>
    </Space>
  );
}
```

---

## 9. WebSocketæ¶ˆæ¯åè®®

### 9.1 å¤ç”¨ç°æœ‰äº‹ä»¶æœºåˆ¶

**æ— éœ€å®šä¹‰æ–°çš„æ¶ˆæ¯ç±»å‹**ï¼Œç›´æ¥å¤ç”¨ `chat_service.py` å·²æœ‰çš„ `tool_start` / `tool_end` äº‹ä»¶ã€‚

å‰ç«¯é€šè¿‡ `tool_name` åˆ¤æ–­æ˜¯å¦æ˜¯ä»»åŠ¡ç®¡ç†å·¥å…·ï¼Œä» `tool_input` æå–æ•°æ®ã€‚

### 9.2 tool_start äº‹ä»¶ï¼ˆå·¥å…·å¼€å§‹è°ƒç”¨ï¼‰

```typescript
// ç°æœ‰äº‹ä»¶æ ¼å¼ï¼ˆæ— éœ€ä¿®æ”¹åç«¯ï¼‰
{
  type: "tool_start",
  tool_name: string,           // å·¥å…·åç§°
  tool_id: number,             // å·¥å…·è°ƒç”¨ ID
  tool_input: object,          // å·¥å…·è¾“å…¥å‚æ•°
  batch_id?: number,           // æ‰¹é‡è°ƒç”¨æ‰¹æ¬¡ ID
  batch_size?: number,         // æ‰¹é‡è°ƒç”¨æ€»æ•°
  batch_index?: number,        // å½“å‰æ˜¯ç¬¬å‡ ä¸ª
}

// ç¤ºä¾‹ï¼šåˆ›å»ºä»»åŠ¡çœ‹æ¿
{
  type: "tool_start",
  tool_name: "create_task_board",
  tool_id: 1,
  tool_input: {
    phase: "analysis",
    tasks: [
      { id: "task_1", title: "è§£æéœ€æ±‚æ–‡æ¡£", scope: "requirement" },
      { id: "task_2", title: "åˆ†æä¸šåŠ¡æµç¨‹", scope: "business" },
      { id: "task_3", title: "ä»£ç é€»è¾‘åˆ†æ", scope: "code" }
    ]
  }
}

// ç¤ºä¾‹ï¼šæ›´æ–°ä»»åŠ¡çŠ¶æ€
{
  type: "tool_start",
  tool_name: "update_task_status",
  tool_id: 2,
  tool_input: {
    task_id: "task_1",
    status: "in_progress",
    progress: 0
  }
}

// ç¤ºä¾‹ï¼šä¿å­˜é˜¶æ®µæ‘˜è¦ï¼ˆæ ‡å¿—é˜¶æ®µç»“æŸï¼‰
{
  type: "tool_start",
  tool_name: "save_phase_summary",
  tool_id: 5,
  tool_input: {
    session_id: "xxx",
    analysis_type: "requirement_summary",
    content: "{...}"
  }
}
```

### 9.3 tool_end äº‹ä»¶ï¼ˆå·¥å…·è°ƒç”¨å®Œæˆï¼‰

```typescript
// ç°æœ‰äº‹ä»¶æ ¼å¼ï¼ˆæ— éœ€ä¿®æ”¹åç«¯ï¼‰
{
  type: "tool_end",
  tool_name: string,
  tool_id: number,
  input_summary: string,       // è¾“å…¥æ‘˜è¦ï¼ˆç”¨äº UI å±•ç¤ºï¼‰
  output_summary: string,      // è¾“å‡ºæ‘˜è¦ï¼ˆç”¨äº UI å±•ç¤ºï¼‰
  elapsed: number,             // è€—æ—¶ï¼ˆç§’ï¼‰
  batch_id?: number,
  batch_size?: number,
  batch_index?: number,
}

// ç¤ºä¾‹
{
  type: "tool_end",
  tool_name: "update_task_status",
  tool_id: 2,
  input_summary: "task_id: task_1, status: completed",
  output_summary: "ä»»åŠ¡çŠ¶æ€å·²æ›´æ–°",
  elapsed: 0.02
}
```

### 9.4 å‰ç«¯ç›‘å¬é€»è¾‘

```typescript
// éœ€è¦ç‰¹æ®Šå¤„ç†çš„ tool_name åˆ—è¡¨
const TESTING_TOOLS = [
  'create_task_board',      // åˆ›å»ºä»»åŠ¡çœ‹æ¿ â†’ åˆå§‹åŒ–ä»»åŠ¡åˆ—è¡¨
  'update_task_status',     // æ›´æ–°ä»»åŠ¡çŠ¶æ€ â†’ æ›´æ–°å•ä¸ªä»»åŠ¡
  'save_phase_summary',     // ä¿å­˜æ‘˜è¦ â†’ æ ‡è®°é˜¶æ®µå®Œæˆ
  'get_phase_summary',      // è¯»å–æ‘˜è¦ â†’ æ ‡è®°æ–°é˜¶æ®µå¼€å§‹
];

// åœ¨ WebSocket onMessage å›è°ƒä¸­
ws.onmessage = (event) => {
  const msg = JSON.parse(event.data);
  
  if (msg.type === 'tool_start' && TESTING_TOOLS.includes(msg.tool_name)) {
    // å¤„ç†ä»»åŠ¡ç®¡ç†å·¥å…·
    handleTestingToolStart(msg);
  }
  
  if (msg.type === 'tool_end' && TESTING_TOOLS.includes(msg.tool_name)) {
    handleTestingToolEnd(msg);
  }
  
  // å…¶ä»–æ¶ˆæ¯èµ°åŸæœ‰é€»è¾‘...
};
```

---

## 10. Agent Promptè®¾è®¡

### 10.1 ä¸‰å¥—ç‹¬ç«‹ Prompt

ç”±äºé‡‡ç”¨ LangGraph çŠ¶æ€æœºï¼Œæ¯ä¸ªé˜¶æ®µæœ‰ç‹¬ç«‹çš„ Promptï¼Œ**é˜¶æ®µåˆ‡æ¢ç”±ä»£ç æ§åˆ¶ï¼Œæ— éœ€ AI ä¸»åŠ¨è°ƒç”¨åˆ‡æ¢å·¥å…·**ã€‚

### 10.2 é˜¶æ®µ1ï¼šéœ€æ±‚åˆ†æ Prompt (PHASE1_ANALYSIS_PROMPT)

```markdown
# Role: éœ€æ±‚åˆ†æä¸ä»£ç ç†è§£ä¸“å®¶

## Profile
- ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æµ‹è¯•åˆ†æå¸ˆï¼Œæ“…é•¿ç†è§£éœ€æ±‚æ–‡æ¡£å’Œä»£ç å®ç°
- ä½ éœ€è¦æ·±å…¥åˆ†æ Coding éœ€æ±‚ï¼Œç†è§£ä¸šåŠ¡æµç¨‹å’Œä»£ç é€»è¾‘
- ä½ çš„åˆ†æç»“æœå°†ä½œä¸ºåç»­æµ‹è¯•æ–¹æ¡ˆå’Œç”¨ä¾‹ç”Ÿæˆçš„åŸºç¡€

## å½“å‰ä»»åŠ¡
- éœ€æ±‚ID: {requirement_id}
- é¡¹ç›®: {project_name}
- ä¼šè¯ID: {session_id}

## å¯ç”¨ä»£ç åº“
{workspace_description}

## å·¥ä½œæµç¨‹

### ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºä»»åŠ¡çœ‹æ¿
åˆ†æéœ€æ±‚åï¼Œ**ç«‹å³è°ƒç”¨** `create_task_board` å·¥å…·åˆ›å»ºä»»åŠ¡çœ‹æ¿ï¼š
```json
{
  "phase": "analysis",
  "tasks": [
    {"id": "task_1", "title": "è§£æéœ€æ±‚æ–‡æ¡£", "scope": "requirement"},
    {"id": "task_2", "title": "åˆ†æä¸šåŠ¡æµç¨‹: xxx", "scope": "business"},
    {"id": "task_3", "title": "ä»£ç é€»è¾‘åˆ†æ: xxx", "scope": "code"},
    ...
  ]
}
```

### ç¬¬äºŒæ­¥ï¼šé€ä¸ªæ‰§è¡Œä»»åŠ¡
å¯¹äºæ¯ä¸ªä»»åŠ¡ï¼š
1. è°ƒç”¨ `update_task_status(task_id, "in_progress")` æ ‡è®°å¼€å§‹
2. æ‰§è¡Œåˆ†æï¼ˆè°ƒç”¨ä»£ç æœç´¢ã€çŸ¥è¯†å›¾è°±ç­‰å·¥å…·ï¼‰
3. è°ƒç”¨ `update_task_status(task_id, "completed", result="...")` æ ‡è®°å®Œæˆ

### ç¬¬ä¸‰æ­¥ï¼šä¿å­˜åˆ†ææ‘˜è¦
æ‰€æœ‰ä»»åŠ¡å®Œæˆåï¼Œè°ƒç”¨ `save_phase_summary` ä¿å­˜ç»“æ„åŒ–æ‘˜è¦ï¼š
```json
{
  "session_id": "{session_id}",
  "analysis_type": "requirement_summary",
  "content": "{...JSONæ ¼å¼çš„åˆ†ææ‘˜è¦...}"
}
```

## æ‘˜è¦å†…å®¹è¦æ±‚
æ‘˜è¦å¿…é¡»åŒ…å«ä»¥ä¸‹ç»“æ„åŒ–ä¿¡æ¯ï¼ˆJSONæ ¼å¼ï¼‰ï¼š
- **requirement**: éœ€æ±‚æ¦‚è¿°ï¼ˆIDã€æ ‡é¢˜ã€æ¶‰åŠæ¨¡å—ï¼‰
- **business_flow**: ä¸šåŠ¡æµç¨‹æ­¥éª¤åˆ—è¡¨
- **code_logic**: ä»£ç å…³é”®é€»è¾‘ï¼ˆå…¥å£å‡½æ•°ã€æ ¡éªŒæ¡ä»¶ã€å¼‚å¸¸åˆ†æ”¯ã€æ•°æ®åº“æ“ä½œï¼‰
- **test_focus**: æµ‹è¯•å…³æ³¨ç‚¹ï¼ˆè¾¹ç•Œå€¼ã€å¼‚å¸¸åœºæ™¯ï¼‰

## å·¥å…·ä½¿ç”¨è§„èŒƒ
- å¿…é¡»ä½¿ç”¨ `get_coding_issue_detail` è·å–éœ€æ±‚è¯¦æƒ…
- ä½¿ç”¨ `search_code_context` è¿›è¡Œä»£ç è¯­ä¹‰æœç´¢
- ä½¿ç”¨ `read_file` è¯»å–å…·ä½“ä»£ç æ–‡ä»¶
- ä½¿ç”¨ `search_businesses` ç­‰çŸ¥è¯†å›¾è°±å·¥å…·äº†è§£ä¸šåŠ¡ä¸Šä¸‹æ–‡

## è¾“å‡ºè§„èŒƒ
- åœ¨æ¶ˆæ¯ä¸­å±•ç¤ºä½ çš„åˆ†ææ€è·¯å’Œå‘ç°
- å…³é”®ä»£ç ç‰‡æ®µå¯ä»¥å¼•ç”¨å±•ç¤º
- æœ€ç»ˆè¾“å‡ºåˆ†ææ‘˜è¦æŠ¥å‘Š
```

### 10.3 é˜¶æ®µ2ï¼šæ–¹æ¡ˆç”Ÿæˆ Prompt (PHASE2_PLAN_PROMPT)

```markdown
# Role: æµ‹è¯•æ–¹æ¡ˆè®¾è®¡å¸ˆ

## Profile
- ä½ æ˜¯ä¸€ä¸ªç»éªŒä¸°å¯Œçš„æµ‹è¯•æ¶æ„å¸ˆ
- åŸºäºéœ€æ±‚åˆ†æç»“æœï¼Œåˆ¶å®šå…¨é¢çš„æµ‹è¯•æ–¹æ¡ˆ
- ä½ çš„æ–¹æ¡ˆå°†æŒ‡å¯¼åç»­çš„æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆ

## ä¸Šä¸‹æ–‡
ä»¥ä¸‹æ˜¯éœ€æ±‚åˆ†æé˜¶æ®µçš„æ‘˜è¦ï¼š
{analysis_summary}

## å½“å‰ä»»åŠ¡
- ä¼šè¯ID: {session_id}

## å·¥ä½œæµç¨‹

### ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºä»»åŠ¡çœ‹æ¿
```json
{
  "phase": "plan",
  "tasks": [
    {"id": "plan_1", "title": "ç¡®å®šæµ‹è¯•èŒƒå›´", "scope": "scope"},
    {"id": "plan_2", "title": "åˆ¶å®šæµ‹è¯•ç­–ç•¥", "scope": "strategy"},
    {"id": "plan_3", "title": "é£é™©åˆ†æ", "scope": "risk"}
  ]
}
```

### ç¬¬äºŒæ­¥ï¼šé€ä¸ªæ‰§è¡Œå¹¶æ›´æ–°çŠ¶æ€
ï¼ˆåŒé˜¶æ®µ1ï¼‰

### ç¬¬ä¸‰æ­¥ï¼šä¿å­˜æµ‹è¯•æ–¹æ¡ˆ
è°ƒç”¨ `save_phase_summary` ä¿å­˜æ–¹æ¡ˆï¼š
```json
{
  "session_id": "{session_id}",
  "analysis_type": "test_plan",
  "content": "{...JSONæ ¼å¼çš„æµ‹è¯•æ–¹æ¡ˆ...}"
}
```

## æ–¹æ¡ˆå†…å®¹è¦æ±‚
- **scope**: æµ‹è¯•èŒƒå›´ï¼ˆin_scope / out_scopeï¼‰
- **strategy**: æµ‹è¯•ç­–ç•¥ï¼ˆåŠŸèƒ½æµ‹è¯•ã€è¾¹ç•Œæµ‹è¯•ã€å¼‚å¸¸æµ‹è¯•çš„æ–¹æ³•ï¼‰
- **risks**: é£é™©åˆ—è¡¨åŠç¼“è§£æªæ–½
- **priority**: ç”¨ä¾‹ä¼˜å…ˆçº§åˆ’åˆ†ï¼ˆP0/P1/P2ï¼‰

## è¾“å‡ºè§„èŒƒ
- è¾“å‡ºæ¸…æ™°çš„æµ‹è¯•æ–¹æ¡ˆæ–‡æ¡£
- åŒ…å«æµ‹è¯•èŒƒå›´ã€ç­–ç•¥ã€é£é™©åˆ†æ
- ä¸ºæ¯ä¸ªåŠŸèƒ½æ¨¡å—æŒ‡å®šæµ‹è¯•ä¼˜å…ˆçº§
```

### 10.4 é˜¶æ®µ3ï¼šç”¨ä¾‹ç”Ÿæˆ Prompt (PHASE3_GENERATE_PROMPT)

```markdown
# Role: æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆä¸“å®¶

## Profile
- ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æµ‹è¯•ç”¨ä¾‹è®¾è®¡å¸ˆ
- åŸºäºæµ‹è¯•æ–¹æ¡ˆï¼Œç”Ÿæˆè¯¦ç»†çš„æµ‹è¯•ç”¨ä¾‹
- ç¡®ä¿è¦†ç›–åŠŸèƒ½ã€è¾¹ç•Œã€å¼‚å¸¸ä¸‰ç±»åœºæ™¯

## ä¸Šä¸‹æ–‡
ä»¥ä¸‹æ˜¯æµ‹è¯•æ–¹æ¡ˆï¼š
{test_plan}

## å½“å‰ä»»åŠ¡
- ä¼šè¯ID: {session_id}

## å·¥ä½œæµç¨‹

### ç¬¬ä¸€æ­¥ï¼šæŒ‰åŠŸèƒ½æ¨¡å—åˆ›å»ºä»»åŠ¡
```json
{
  "phase": "generate",
  "tasks": [
    {"id": "gen_1", "title": "ç”Ÿæˆç”¨ä¾‹: å¼€å¡ä¸»æµç¨‹", "scope": "å¼€å¡ä¸»æµç¨‹"},
    {"id": "gen_2", "title": "ç”Ÿæˆç”¨ä¾‹: èµ„æ ¼æ ¡éªŒ", "scope": "èµ„æ ¼æ ¡éªŒ"},
    {"id": "gen_3", "title": "ç”Ÿæˆç”¨ä¾‹: æ”¯ä»˜å¤„ç†", "scope": "æ”¯ä»˜å¤„ç†"},
    ...
  ]
}
```

### ç¬¬äºŒæ­¥ï¼šé€ä¸ªåŠŸèƒ½ç”Ÿæˆç”¨ä¾‹
å¯¹äºæ¯ä¸ªåŠŸèƒ½æ¨¡å—ï¼š
1. æ ‡è®°ä»»åŠ¡å¼€å§‹
2. ç”ŸæˆåŠŸèƒ½ç”¨ä¾‹ï¼ˆæ­£å¸¸æµç¨‹ï¼‰
3. ç”Ÿæˆè¾¹ç•Œç”¨ä¾‹ï¼ˆè¾¹ç•Œå€¼ï¼‰
4. ç”Ÿæˆå¼‚å¸¸ç”¨ä¾‹ï¼ˆå¼‚å¸¸åœºæ™¯ï¼‰
5. æ ‡è®°ä»»åŠ¡å®Œæˆï¼Œresult ä¸­åŒ…å«è¯¥æ¨¡å—çš„ç”¨ä¾‹æ•°é‡

### ç¬¬ä¸‰æ­¥ï¼šä¿å­˜ç”¨ä¾‹é›†
è°ƒç”¨ `save_phase_summary` ä¿å­˜æ‰€æœ‰ç”¨ä¾‹ï¼š
```json
{
  "session_id": "{session_id}",
  "analysis_type": "test_cases",
  "content": "{...JSONæ ¼å¼çš„ç”¨ä¾‹é›†...}"
}
```

## ç”¨ä¾‹æ ¼å¼è¦æ±‚
æ¯ä¸ªç”¨ä¾‹å¿…é¡»åŒ…å«ï¼š
```json
{
  "id": "TC_001",
  "module": "å¼€å¡ä¸»æµç¨‹",
  "type": "functional",  // functional / boundary / exception
  "priority": "P0",
  "title": "æ­£å¸¸å¼€å¡æµç¨‹-VIPç”¨æˆ·é¦–æ¬¡å¼€å¡",
  "precondition": "ç”¨æˆ·å·²ç™»å½•ï¼ŒVIPç­‰çº§>=2ï¼Œä½™é¢>=0",
  "steps": [
    "1. è¿›å…¥æœˆå¡å¼€é€šé¡µé¢",
    "2. ç‚¹å‡»å¼€é€šæŒ‰é’®",
    "3. ç¡®è®¤æ”¯ä»˜"
  ],
  "expected": "å¼€å¡æˆåŠŸï¼Œæ”¶åˆ°å¼€é€šé€šçŸ¥",
  "test_data": {
    "userLevel": 2,
    "balance": 100
  }
}
```

## è¾“å‡ºè§„èŒƒ
- æŒ‰æ¨¡å—ç»„ç»‡è¾“å‡ºç”¨ä¾‹
- æ¯ä¸ªæ¨¡å—åŒ…å«åŠŸèƒ½ã€è¾¹ç•Œã€å¼‚å¸¸ä¸‰ç±»ç”¨ä¾‹
- æœ€ç»ˆæ±‡æ€»ç”¨ä¾‹ç»Ÿè®¡ï¼ˆæ€»æ•°ã€æŒ‰ç±»å‹ã€æŒ‰ä¼˜å…ˆçº§ï¼‰
```

### 10.5 Prompt åŠ¨æ€æ³¨å…¥

```python
def get_phase_prompt(phase: str, context: dict) -> str:
    """æ ¹æ®é˜¶æ®µå’Œä¸Šä¸‹æ–‡ç”Ÿæˆ Prompt"""
    
    if phase == "analysis":
        return PHASE1_ANALYSIS_PROMPT.format(
            requirement_id=context['requirement_id'],
            project_name=context['project_name'],
            session_id=context['session_id'],
            workspace_description=context['workspace_description'],
        )
    
    elif phase == "plan":
        return PHASE2_PLAN_PROMPT.format(
            session_id=context['session_id'],
            analysis_summary=context['analysis_summary'],  # ä»æ•°æ®åº“è¯»å–
        )
    
    elif phase == "generate":
        return PHASE3_GENERATE_PROMPT.format(
            session_id=context['session_id'],
            test_plan=context['test_plan'],  # ä»æ•°æ®åº“è¯»å–
        )
```

---

## 11. å¼€å‘è®¡åˆ’

### 11.1 Phase 1: åŸºç¡€æ¡†æ¶ï¼ˆ5å¤©ï¼‰

**Day 1-2: åç«¯åŸºç¡€**
- [ ] åˆ›å»ºæ•°æ®åº“è¡¨ï¼ˆtest_session_analysisï¼‰
- [x] å®ç° Coding API æ‰©å±•ï¼ˆ3ä¸ªæ¥å£ï¼šé¡¹ç›®åˆ—è¡¨ã€è¿­ä»£åˆ—è¡¨ã€éœ€æ±‚åˆ—è¡¨ï¼‰ âœ… 2024-12-09
- [x] åç«¯ Agent é…ç½®ï¼ˆintelligent_testingï¼‰ âœ… 2024-12-09
- [ ] å®ç° LangGraph çŠ¶æ€æœºæ¡†æ¶ï¼ˆtesting_graph.pyï¼‰
- [ ] å®ç°æµ‹è¯•å·¥å…·é›†ï¼ˆ5ä¸ªå·¥å…·ï¼‰

**Day 3-4: å‰ç«¯UI**
- [x] å‰ç«¯é¡µé¢æ¡†æ¶ï¼ˆåœ¨ ChatPage.tsx ä¸­é›†æˆï¼‰ âœ… 2024-12-09
- [x] å®ç°çº§è”é€‰æ‹©å™¨ï¼ˆè¿­ä»£ã€éœ€æ±‚ï¼Œæ”¯æŒåç«¯å…³é”®è¯æœç´¢ï¼‰ âœ… 2024-12-09
- [x] å‰ç«¯ Coding API å°è£…ï¼ˆcoding.tsï¼‰ âœ… 2024-12-09
- [ ] å®ç° LeftTaskPanel ä»»åŠ¡çœ‹æ¿
- [ ] å®ç° RightTimelinePanel æ—¶é—´çº¿
- [ ] é›†æˆ tool_start/tool_end äº‹ä»¶ç›‘å¬

**Day 5: è”è°ƒæµ‹è¯•**
- [ ] ç«¯åˆ°ç«¯æµç¨‹æµ‹è¯•
- [ ] LangGraph é˜¶æ®µåˆ‡æ¢éªŒè¯
- [ ] å‰ç«¯çŠ¶æ€æ›´æ–°éªŒè¯

### 11.2 Phase 2: åŠŸèƒ½å®Œå–„ï¼ˆ5å¤©ï¼‰

**Day 6-7: é˜¶æ®µ1å®ç°**
- [ ] å®Œå–„ PHASE1_ANALYSIS_PROMPT
- [ ] æµ‹è¯•éœ€æ±‚è§£æå’Œä»£ç åˆ†æ
- [ ] éªŒè¯æ‘˜è¦ç”Ÿæˆè´¨é‡

**Day 8-9: é˜¶æ®µ2-3å®ç°**
- [ ] å®Œå–„ PHASE2_PLAN_PROMPT
- [ ] å®Œå–„ PHASE3_GENERATE_PROMPT
- [ ] ä¼˜åŒ–ç”¨ä¾‹æ ¼å¼è¾“å‡º

**Day 10: ä¼˜åŒ–å’Œè°ƒè¯•**
- [ ] Prompt å·¥ç¨‹ä¼˜åŒ–ï¼ˆé’ˆå¯¹å®é™…æµ‹è¯•åé¦ˆï¼‰
- [ ] UI ä½“éªŒä¼˜åŒ–
- [ ] é”™è¯¯å¤„ç†å’Œè¾¹ç•Œæƒ…å†µ

### 11.3 Phase 3: æµ‹è¯•ä¸ä¸Šçº¿ï¼ˆ3å¤©ï¼‰

**Day 11-12: æµ‹è¯•**
- [ ] åŠŸèƒ½æµ‹è¯•ï¼ˆ5ä¸ªå…¸å‹éœ€æ±‚ï¼‰
- [ ] Token æ¶ˆè€—éªŒè¯ï¼ˆç¡®ä¿åˆ†é˜¶æ®µæ–¹æ¡ˆæœ‰æ•ˆï¼‰
- [ ] è¾¹ç•Œæµ‹è¯•ï¼ˆä¸­æ–­æ¢å¤ã€å¼‚å¸¸å¤„ç†ï¼‰

**Day 13: æ–‡æ¡£ä¸ä¸Šçº¿**
- [ ] ç”¨æˆ·ä½¿ç”¨æ–‡æ¡£
- [ ] éƒ¨ç½²ä¸Šçº¿
- [ ] å›¢é˜ŸåŸ¹è®­

### 11.4 å·¥ä½œé‡è¯„ä¼°

| æ¨¡å— | å·¥ä½œé‡ | è¯´æ˜ |
|-----|-------|------|
| åç«¯ API | 1å¤© | Coding æ¥å£æ‰©å±• |
| LangGraph çŠ¶æ€æœº | 2å¤© | çŠ¶æ€æœºæ¡†æ¶ + é˜¶æ®µèŠ‚ç‚¹ |
| æµ‹è¯•å·¥å…·é›† | 1å¤© | 5ä¸ªå·¥å…·å®ç° |
| å‰ç«¯ UI | 4å¤© | é¡µé¢ + ç»„ä»¶ + äº‹ä»¶ç›‘å¬ |
| Prompt å·¥ç¨‹ | 3å¤© | ä¸‰å¥— Prompt è®¾è®¡ä¸è°ƒä¼˜ |
| æµ‹è¯• | 2å¤© | åŠŸèƒ½æµ‹è¯• + è¾¹ç•Œæµ‹è¯• |
| **æ€»è®¡** | **13å¤©** | - |

---

## é™„å½•

### A. å…³é”®æŠ€æœ¯å†³ç­–

| å†³ç­–ç‚¹ | é€‰é¡¹A | é€‰é¡¹B | æœ€ç»ˆé€‰æ‹© | ç†ç”± |
|-------|-------|-------|---------|------|
| æµç¨‹æ§åˆ¶ | çº¯ Prompt æ§åˆ¶ | LangGraph çŠ¶æ€æœº | **LangGraph** | å¼ºåˆ¶é˜¶æ®µé¡ºåºï¼Œé¿å… AI è·³è¿‡æˆ–ä¹±åº |
| Token ç®¡ç† | å…¨é‡å†å²ä¼ é€’ | åˆ†é˜¶æ®µæ‘˜è¦å‹ç¼© | **æ‘˜è¦å‹ç¼©** | é¿å… context çˆ†ç‚¸ï¼Œæ¯é˜¶æ®µç‹¬ç«‹ thread |
| çŠ¶æ€æ¨é€ | è‡ªå®šä¹‰æ¶ˆæ¯ç±»å‹ | å¤ç”¨ tool_start/end | **å¤ç”¨ç°æœ‰** | æ— éœ€ä¿®æ”¹ chat_serviceï¼Œå¼€å‘æˆæœ¬ä½ |
| æ•°æ®åº“è®¾è®¡ | æ–°å¢ç‹¬ç«‹è¡¨ | æ‰©å±• Conversation è¡¨ | **æ‰©å±•ç°æœ‰è¡¨** | æŸ¥è¯¢ç»Ÿä¸€ï¼Œé¿å… UNIONï¼Œå‰ç«¯é€»è¾‘ç®€å• |
| å­˜å‚¨æ–¹æ¡ˆ | Neo4j | SQLite | **SQLite** | è½»é‡ã€å·²æœ‰ã€å¤Ÿç”¨ |

### B. é£é™©ä¸åº”å¯¹

| é£é™© | æ¦‚ç‡ | å½±å“ | åº”å¯¹æªæ–½ |
|-----|------|------|---------|
| æ‘˜è¦ä¸¢å¤±å…³é”®ä¿¡æ¯ | ä¸­ | é«˜ | è®¾è®¡ç»“æ„åŒ–æ‘˜è¦æ¨¡æ¿ï¼Œå…³é”®ä¿¡æ¯å¿…å¡« |
| AI ä¸æŒ‰è§„èŒƒè°ƒç”¨å·¥å…· | ä¸­ | ä¸­ | LangGraph æ§åˆ¶æµç¨‹ï¼ŒPrompt å¼ºè°ƒå·¥å…·é¡ºåº |
| LangGraph é›†æˆå¤æ‚ | ä¸­ | ä¸­ | å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼Œå…ˆå®ç°æœ€å°å¯ç”¨ç‰ˆæœ¬ |
| ç”¨ä¾‹è´¨é‡ä¸è¾¾æ ‡ | ä¸­ | ä¸­ | è¿­ä»£ä¼˜åŒ– Promptï¼Œæ”¶é›†æµ‹è¯•åé¦ˆ |
| å‰ç«¯çŠ¶æ€åŒæ­¥å»¶è¿Ÿ | ä½ | ä½ | ç°æœ‰ WebSocket å·²éªŒè¯ç¨³å®š |

### C. åç»­ä¼˜åŒ–æ–¹å‘

1. **ç”¨ä¾‹è¯„å®¡åŠŸèƒ½**: æ–°å¢é˜¶æ®µ4ï¼Œæ™ºèƒ½è¯„å®¡ç”Ÿæˆçš„ç”¨ä¾‹
2. **ç”¨ä¾‹ç¼–è¾‘åŠŸèƒ½**: æ”¯æŒåœ¨çº¿ç¼–è¾‘å’Œå¾®è°ƒç”¨ä¾‹
3. **å†å²è®°å½•**: æ”¯æŒæŸ¥çœ‹å’Œå¤ç”¨å†å²ç”Ÿæˆçš„æ–¹æ¡ˆå’Œç”¨ä¾‹
4. **æ¨¡æ¿ç®¡ç†**: æ”¯æŒè‡ªå®šä¹‰ç”¨ä¾‹æ¨¡æ¿å’Œè¾“å‡ºæ ¼å¼
5. **Excel å¯¼å‡º**: å¯¼å‡ºç”¨ä¾‹ä¸º Excel æ ¼å¼ï¼ˆæ ‡å‡†æµ‹è¯•ç”¨ä¾‹æ¨¡æ¿ï¼‰
6. **å…¨é‡å†å²æ¨¡å¼**: å¯é€‰æ¨¡å¼ï¼Œå¯¹äºå¤æ‚éœ€æ±‚ä¿ç•™å…¨éƒ¨ä¸Šä¸‹æ–‡

### D. æ–‡ä»¶æ¸…å•

æ–°å¢/ä¿®æ”¹çš„æ–‡ä»¶åˆ—è¡¨ï¼š

**åç«¯**:
```
backend/app/
â”œâ”€â”€ api/v1/
â”‚   â”œâ”€â”€ coding.py                    # âœ… å·²ä¿®æ”¹ï¼šæ–°å¢3ä¸ªæ¥å£ï¼ˆé¡¹ç›®/è¿­ä»£/éœ€æ±‚åˆ—è¡¨ï¼‰
â”‚   â””â”€â”€ testing.py                   # å¾…å¼€å‘ï¼šæµ‹è¯•åŠ©æ‰‹ WebSocket ç«¯ç‚¹
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ coding_service.py            # âœ… å·²ä¿®æ”¹ï¼šæ–°å¢3ä¸ªæ–¹æ³• + å…³é”®è¯æœç´¢æ”¯æŒ
â”‚   â””â”€â”€ testing_service.py           # å¾…å¼€å‘ï¼šæµ‹è¯•å·¥ä½œæµæœåŠ¡ï¼ˆæ ¸å¿ƒï¼‰
â”œâ”€â”€ llm/langchain/
â”‚   â”œâ”€â”€ testing_graph.py             # å¾…å¼€å‘ï¼šLangGraph çŠ¶æ€æœºå®šä¹‰
â”‚   â”œâ”€â”€ configs.py                   # âœ… å·²ä¿®æ”¹ï¼šæ–°å¢ intelligent_testing Agent é…ç½®
â”‚   â””â”€â”€ tools/
â”‚       â””â”€â”€ testing.py               # å¾…å¼€å‘ï¼šæµ‹è¯•å·¥å…·é›†ï¼ˆ5ä¸ªå·¥å…·ï¼‰
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ chat.py                      # å¾…ä¿®æ”¹ï¼šæ‰©å±• Conversation è¡¨ï¼ˆæ–°å¢7ä¸ªæµ‹è¯•ä¸“ç”¨å­—æ®µï¼‰
â”‚   â””â”€â”€ testing.py                   # å¾…å¼€å‘ï¼šTestSessionAnalysis æ¨¡å‹
â””â”€â”€ schemas/
    â”œâ”€â”€ coding.py                    # âœ… å·²ä¿®æ”¹ï¼šæ–°å¢é¡¹ç›®/è¿­ä»£/éœ€æ±‚ Schema + keyword å‚æ•°
    â””â”€â”€ testing.py                   # å¾…å¼€å‘ï¼šè¯·æ±‚/å“åº” Schema
```

**å‰ç«¯**:
```
frontend/src/
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ ChatPage.tsx                 # âœ… å·²ä¿®æ”¹ï¼šé›†æˆæ™ºèƒ½æµ‹è¯•åŠ©æ‰‹é€‰æ‹©å™¨ï¼ˆè¿­ä»£/éœ€æ±‚çº§è”ï¼Œæ”¯æŒåç«¯æœç´¢ï¼‰
â”‚   â””â”€â”€ TestingChatPage.tsx          # å¯é€‰ï¼šç‹¬ç«‹æµ‹è¯•åŠ©æ‰‹é¡µé¢ï¼ˆå¦‚éœ€æ›´å¤æ‚UIï¼‰
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ TopConfigBar.tsx             # å¯é€‰ï¼šé¡¶éƒ¨é…ç½®æ ç»„ä»¶ï¼ˆå·²å†…è”åœ¨ ChatPageï¼‰
â”‚   â”œâ”€â”€ LeftTaskPanel.tsx            # å¾…å¼€å‘ï¼šå·¦ä¾§ä»»åŠ¡çœ‹æ¿
â”‚   â””â”€â”€ RightTimelinePanel.tsx       # å¾…å¼€å‘ï¼šå³ä¾§æ—¶é—´çº¿
â”œâ”€â”€ hooks/
â”‚   â””â”€â”€ useTestingTaskBoard.ts       # å¾…å¼€å‘ï¼šä»»åŠ¡çœ‹æ¿çŠ¶æ€ç®¡ç†
â”œâ”€â”€ api/
â”‚   â””â”€â”€ coding.ts                    # âœ… æ–°å¢ï¼š3ä¸ªæ¥å£ï¼ˆé¡¹ç›®/è¿­ä»£/éœ€æ±‚åˆ—è¡¨ï¼Œæ”¯æŒ keyword æœç´¢ï¼‰
â””â”€â”€ router.tsx                       # æ— éœ€ä¿®æ”¹ï¼šAgent åˆ‡æ¢å·²åœ¨ ChatPage å†…éƒ¨å®ç°
```

**ä¾èµ–æ›´æ–°**:
```
backend/requirements.txt             # æ–°å¢ï¼šlanggraph >= 0.2.0
```

### E. LangGraph API é€ŸæŸ¥

```python
# 1. å®‰è£…
pip install langgraph

# 2. æ ¸å¿ƒå¯¼å…¥
from langgraph.graph import StateGraph, START, END
from langgraph.graph.message import add_messages
from langgraph.prebuilt import create_react_agent
from langgraph.checkpoint.sqlite.aio import AsyncSqliteSaver

# 3. çŠ¶æ€å®šä¹‰ï¼ˆä½¿ç”¨ Annotated + add_messagesï¼‰
from typing import Annotated
from typing_extensions import TypedDict

class MyState(TypedDict):
    messages: Annotated[list, add_messages]  # è‡ªåŠ¨è¿½åŠ 
    custom_field: str                         # è¦†ç›–

# 4. æ„å»ºå›¾
graph_builder = StateGraph(MyState)
graph_builder.add_node("node_name", node_function)
graph_builder.add_edge(START, "node_name")
graph_builder.add_edge("node_name", END)
graph = graph_builder.compile(checkpointer=checkpointer)

# 5. æ‰§è¡Œï¼ˆæµå¼ï¼‰
async for event in graph.astream_events(initial_state, config, version="v2"):
    # äº‹ä»¶ç±»å‹ï¼šon_tool_start, on_tool_end, on_chat_model_stream, ...
    pass
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: v2.2  
**æœ€åæ›´æ–°**: 2024-12-09  
**çŠ¶æ€**: å¼€å‘ä¸­ï¼ˆåŸºç¡€æ¡†æ¶å·²å®Œæˆï¼‰

---

## å·²å®ŒæˆåŠŸèƒ½æ‘˜è¦

### åç«¯ API
- `POST /api/v1/coding/projects` - è·å–é¡¹ç›®åˆ—è¡¨
- `POST /api/v1/coding/iterations` - è·å–è¿­ä»£åˆ—è¡¨ï¼ˆæ”¯æŒ keywords æœç´¢ï¼‰
- `POST /api/v1/coding/issues` - è·å–éœ€æ±‚åˆ—è¡¨ï¼ˆæ”¯æŒ keyword æœç´¢ï¼‰

### å‰ç«¯ç•Œé¢
- æ™ºèƒ½æµ‹è¯•åŠ©æ‰‹ Agent å·²æ³¨å†Œï¼Œå¯åœ¨é¡¶éƒ¨ä¸‹æ‹‰èœå•åˆ‡æ¢
- è¿­ä»£é€‰æ‹©å™¨ï¼šè‡ªåŠ¨åŠ è½½é¡¹ç›®è¿­ä»£åˆ—è¡¨ï¼Œæ”¯æŒåç«¯å…³é”®è¯æœç´¢
- éœ€æ±‚é€‰æ‹©å™¨ï¼šé€‰æ‹©è¿­ä»£åè‡ªåŠ¨åŠ è½½ï¼Œæ”¯æŒåç«¯å…³é”®è¯æœç´¢
- é¡¹ç›®å›ºå®šä¸º `yongcepingtaipro2.0`ï¼ˆåç»­å¯æ‰©å±•ï¼‰

å¦‚æœ‰ç–‘é—®ï¼Œè¯·è”ç³»é¡¹ç›®è´Ÿè´£äººã€‚
