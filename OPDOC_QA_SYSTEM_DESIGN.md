# æ“ä½œæ–‡æ¡£æ™ºèƒ½é—®ç­”ç³»ç»Ÿè®¾è®¡æ–¹æ¡ˆ V2

> **ç‰ˆæœ¬**: v2.0 | **æ—¥æœŸ**: 2025-12-11  
> **æ ¸å¿ƒç†å¿µ**: å¤–éƒ¨æ–‡æ¡£ä¸­å¿ƒ + æ ‘çŠ¶ç®¡ç† + LightRAG + å¤ç”¨ç°æœ‰Chat

---

## ä¸€ã€ç³»ç»Ÿæ¦‚è¿°

### 1.1 ä¸šåŠ¡èƒŒæ™¯

ä¼ä¸šå†…éƒ¨æœ‰ç‹¬ç«‹çš„**æ–‡æ¡£ä¸­å¿ƒ**ç³»ç»Ÿï¼Œå­˜å‚¨äº†å¤§é‡æ“ä½œæ–‡æ¡£ã€æ‰‹å†Œã€æµç¨‹æŒ‡å—ç­‰ã€‚æœ¬ç³»ç»Ÿçš„ç›®æ ‡æ˜¯ï¼š

1. ä»æ–‡æ¡£ä¸­å¿ƒ**æ‰¹é‡å¯¼å…¥**æ–‡æ¡£åˆ°æœ¬ç³»ç»Ÿ
2. ä¿æŒæ–‡æ¡£çš„**æ ‘çŠ¶å±‚çº§ç»“æ„**
3. å¯¹æ–‡æ¡£è¿›è¡Œ**é¢„å¤„ç†å¢å¼º**ï¼ˆå¯é€‰ï¼‰
4. åŒæ­¥åˆ° **LightRAG** æ„å»ºçŸ¥è¯†ç´¢å¼•
5. é€šè¿‡ç°æœ‰ **Chat é¡µé¢**è¿›è¡Œæ™ºèƒ½é—®ç­”

### 1.2 ä¸ç°æœ‰ç³»ç»Ÿçš„å…³ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          ç°æœ‰ç³»ç»Ÿ (å·²å®ç°)                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  ChatPage   â”‚  â”‚  ReactFlow  â”‚  â”‚   Agent     â”‚  â”‚   CrewAI    â”‚        â”‚
â”‚  â”‚  å¤šAgentå¯¹è¯ â”‚  â”‚  å›¾è°±å¯è§†åŒ–  â”‚  â”‚  å·¥å…·é“¾     â”‚  â”‚  éª¨æ¶ç”Ÿæˆ   â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ å¤ç”¨
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          æ–°ç³»ç»Ÿ (å¾…å®ç°)                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  æ–‡æ¡£å¯¼å…¥    â”‚  â”‚  æ ‘çŠ¶ç®¡ç†    â”‚  â”‚  é¢„å¤„ç†å¢å¼º  â”‚  â”‚  LightRAG   â”‚        â”‚
â”‚  â”‚  (æ–°)       â”‚  â”‚  (æ–°)       â”‚  â”‚  (æ–°)       â”‚  â”‚  (æ–°)       â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                              â”‚              â”‚
â”‚                                                              â–¼              â”‚
â”‚                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚                                              â”‚ ChatPage (å¤ç”¨)         â”‚    â”‚
â”‚                                              â”‚ æ–°å¢ Agent ç±»å‹:        â”‚    â”‚
â”‚                                              â”‚ "æ“ä½œæ–‡æ¡£é—®ç­”"          â”‚    â”‚
â”‚                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äºŒã€æ•°æ®æµè®¾è®¡

### 2.1 å®Œæ•´æ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ–‡æ¡£ä¸­å¿ƒ    â”‚â”€â”€â”€â”€â–¶â”‚   æ‰¹é‡å¯¼å…¥    â”‚â”€â”€â”€â”€â–¶â”‚   é¢„å¤„ç†å¢å¼º  â”‚â”€â”€â”€â”€â–¶â”‚  LightRAG   â”‚â”€â”€â”€â”€â–¶â”‚   Chaté—®ç­”   â”‚
â”‚   (å¤–éƒ¨)     â”‚     â”‚   æ ‘çŠ¶å­˜å‚¨    â”‚     â”‚   (å¯é€‰)     â”‚     â”‚   ç´¢å¼•      â”‚     â”‚   (å¤ç”¨)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                    â”‚                    â”‚                    â”‚                    â”‚
       â”‚                    â”‚                    â”‚                    â”‚                    â”‚
       â–¼                    â–¼                    â–¼                    â–¼                    â–¼
  APIæ¥å£è·å–          SQLiteå­˜å‚¨           LLMè°ƒç”¨             å‘é‡+å›¾è°±           æµå¼å›ç­”
  æ ‡é¢˜+å†…å®¹            ä¿æŒå±‚çº§ç»“æ„          å†…å®¹è¡¥å¼º            çŸ¥è¯†æ£€ç´¢            æ¥æºè¿½æº¯
```

### 2.2 æ–‡æ¡£çŠ¶æ€æµè½¬

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ pending â”‚â”€â”€â”€â”€â–¶â”‚ importedâ”‚â”€â”€â”€â”€â–¶â”‚enhanced â”‚â”€â”€â”€â”€â–¶â”‚ indexed â”‚â”€â”€â”€â”€â–¶â”‚  ready  â”‚
â”‚ å¾…å¯¼å…¥   â”‚     â”‚ å·²å¯¼å…¥   â”‚     â”‚ å·²å¢å¼º   â”‚     â”‚ å·²ç´¢å¼•   â”‚     â”‚ å¯æŸ¥è¯¢   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚               â”‚               â”‚
                     â”‚               â”‚               â”‚
                     â–¼               â–¼               â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  failed â”‚    â”‚  failed â”‚    â”‚  failed â”‚
                â”‚ å¯¼å…¥å¤±è´¥ â”‚    â”‚ å¢å¼ºå¤±è´¥ â”‚    â”‚ ç´¢å¼•å¤±è´¥ â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

çŠ¶æ€è¯´æ˜ï¼š
- pending:   åœ¨æ–‡æ¡£ä¸­å¿ƒå·²é€‰æ‹©ï¼Œå¾…å¯¼å…¥
- imported:  å·²å¯¼å…¥æœ¬ç³»ç»Ÿï¼ŒåŸå§‹å†…å®¹å·²ä¿å­˜
- enhanced:  å·²å®Œæˆé¢„å¤„ç†å¢å¼ºï¼ˆå¯è·³è¿‡ï¼‰
- indexed:   å·²åŒæ­¥åˆ° LightRAG
- ready:     å¯ç”¨äºé—®ç­”æŸ¥è¯¢
- failed:    å¤„ç†å¤±è´¥ï¼Œè®°å½•é”™è¯¯ä¿¡æ¯
```

---

## ä¸‰ã€æ•°æ®æ¨¡å‹è®¾è®¡

### 3.1 æ–‡æ¡£æ ‘èŠ‚ç‚¹ (DocTreeNode)

```python
class DocTreeNode(SQLModel, table=True):
    """æ–‡æ¡£æ ‘èŠ‚ç‚¹ - æ”¯æŒæ ‘çŠ¶å±‚çº§ç»“æ„"""
    __tablename__ = "opdoc_tree_node"
    
    id: str = Field(primary_key=True)           # æœ¬ç³»ç»ŸID
    external_id: str | None                      # æ–‡æ¡£ä¸­å¿ƒçš„åŸå§‹ID
    
    # æ ‘ç»“æ„
    parent_id: str | None = Field(foreign_key="opdoc_tree_node.id")
    path: str                                    # ç‰©åŒ–è·¯å¾„, å¦‚ "/root/è¿ç»´/K8s/"
    level: int                                   # å±‚çº§æ·±åº¦, 0=æ ¹èŠ‚ç‚¹
    sort_order: int = 0                          # åŒçº§æ’åº
    
    # èŠ‚ç‚¹ä¿¡æ¯
    name: str                                    # èŠ‚ç‚¹åç§° (æ–‡æ¡£æ ‡é¢˜æˆ–ç›®å½•å)
    node_type: str                               # "folder" | "document"
    
    # æ–‡æ¡£å†…å®¹ (ä»… node_type="document" æ—¶æœ‰å€¼)
    content_raw: str | None                      # åŸå§‹å†…å®¹ (Markdown/HTML)
    content_enhanced: str | None                 # å¢å¼ºåå†…å®¹
    content_for_index: str | None                # ç”¨äºç´¢å¼•çš„æœ€ç»ˆå†…å®¹
    
    # çŠ¶æ€ç®¡ç†
    status: str = "pending"                      # pending/imported/enhanced/indexed/ready/failed
    error_message: str | None                    # å¤±è´¥æ—¶çš„é”™è¯¯ä¿¡æ¯
    
    # å…ƒæ•°æ®
    source_url: str | None                       # æ–‡æ¡£ä¸­å¿ƒåŸå§‹URL
    tags: str | None                             # JSONæ•°ç»„, æ ‡ç­¾
    metadata: str | None                         # JSON, æ‰©å±•å…ƒæ•°æ®
    
    # æ—¶é—´æˆ³
    created_at: datetime
    updated_at: datetime
    imported_at: datetime | None                 # å¯¼å…¥æ—¶é—´
    enhanced_at: datetime | None                 # å¢å¼ºæ—¶é—´
    indexed_at: datetime | None                  # ç´¢å¼•æ—¶é—´
```

### 3.2 çŸ¥è¯†åº“é…ç½® (KnowledgeBase)

```python
class KnowledgeBase(SQLModel, table=True):
    """çŸ¥è¯†åº“é…ç½® - å¯¹åº”æ–‡æ¡£ä¸­å¿ƒçš„ä¸€ä¸ªçŸ¥è¯†åº“"""
    __tablename__ = "opdoc_knowledge_base"
    
    id: str = Field(primary_key=True)
    name: str                                    # çŸ¥è¯†åº“åç§°
    description: str | None                      # æè¿°
    
    # æ–‡æ¡£ä¸­å¿ƒé…ç½®
    external_base_id: str                        # æ–‡æ¡£ä¸­å¿ƒçŸ¥è¯†åº“ID
    api_endpoint: str                            # APIåœ°å€
    api_key: str | None                          # APIå¯†é’¥ (åŠ å¯†å­˜å‚¨)
    
    # åŒæ­¥é…ç½®
    auto_sync: bool = False                      # æ˜¯å¦è‡ªåŠ¨åŒæ­¥
    sync_interval: int = 3600                    # åŒæ­¥é—´éš”(ç§’)
    last_sync_at: datetime | None                # ä¸Šæ¬¡åŒæ­¥æ—¶é—´
    
    # ç»Ÿè®¡
    total_docs: int = 0                          # æ–‡æ¡£æ€»æ•°
    indexed_docs: int = 0                        # å·²ç´¢å¼•æ•°
    
    # æ—¶é—´æˆ³
    created_at: datetime
    updated_at: datetime
```

### 3.3 ç´¢å¼•å…³ç³»æ˜ å°„

```python
class DocIndexMapping(SQLModel, table=True):
    """æ–‡æ¡£ä¸LightRAGç´¢å¼•çš„æ˜ å°„å…³ç³»"""
    __tablename__ = "opdoc_index_mapping"
    
    id: str = Field(primary_key=True)
    doc_id: str = Field(foreign_key="opdoc_tree_node.id")
    
    # LightRAG ç´¢å¼•ä¿¡æ¯
    lightrag_doc_id: str | None                  # LightRAGå†…éƒ¨æ–‡æ¡£ID
    chunk_count: int = 0                         # åˆ†å—æ•°é‡
    entity_count: int = 0                        # æå–çš„å®ä½“æ•°
    relation_count: int = 0                      # æå–çš„å…³ç³»æ•°
    
    # ç´¢å¼•çŠ¶æ€
    index_version: int = 1                       # ç´¢å¼•ç‰ˆæœ¬ (å†…å®¹æ›´æ–°æ—¶é€’å¢)
    indexed_content_hash: str | None             # å·²ç´¢å¼•å†…å®¹çš„hash (æ£€æµ‹å˜æ›´)
    
    created_at: datetime
    updated_at: datetime
```

---

## å››ã€åŠŸèƒ½æ¨¡å—è®¾è®¡

### 4.1 æ¨¡å—1: æ–‡æ¡£å¯¼å…¥

#### 4.1.1 åŠŸèƒ½è¯´æ˜

ä»å¤–éƒ¨æ–‡æ¡£ä¸­å¿ƒæ‰¹é‡è·å–æ–‡æ¡£ï¼Œä¿æŒåŸæœ‰æ ‘çŠ¶å±‚çº§ç»“æ„å­˜å…¥æœ¬ç³»ç»Ÿã€‚

#### 4.1.2 æ¥å£è®¾è®¡

```python
# æ–‡æ¡£ä¸­å¿ƒ API (å‡è®¾)
GET /api/knowledge-base/{base_id}/tree
Response: {
    "id": "kb_001",
    "name": "è¿ç»´çŸ¥è¯†åº“",
    "children": [
        {
            "id": "folder_001",
            "name": "Kubernetes",
            "type": "folder",
            "children": [
                {
                    "id": "doc_001",
                    "name": "Podé‡å¯æ“ä½œæ‰‹å†Œ",
                    "type": "document",
                    "content": "# Podé‡å¯æ“ä½œæ‰‹å†Œ\n...",
                    "url": "https://docs.example.com/k8s/pod-restart"
                },
                ...
            ]
        },
        ...
    ]
}
```

#### 4.1.3 æœ¬ç³»ç»Ÿ API

```
POST /api/v1/opdoc/import
è¯·æ±‚ä½“: {
    "knowledge_base_id": "kb_001",      # æ–‡æ¡£ä¸­å¿ƒçŸ¥è¯†åº“ID
    "selected_ids": ["doc_001", "doc_002"],  # å¯é€‰: æŒ‡å®šå¯¼å…¥çš„æ–‡æ¡£ID
    "include_folders": true              # æ˜¯å¦åŒ…å«ç›®å½•ç»“æ„
}
å“åº”: {
    "task_id": "import_xxx",
    "total": 15,
    "message": "å¯¼å…¥ä»»åŠ¡å·²åˆ›å»º"
}

GET /api/v1/opdoc/import/{task_id}/status
å“åº”: {
    "status": "processing",
    "progress": 10,
    "total": 15,
    "current": "æ­£åœ¨å¯¼å…¥: Podé‡å¯æ“ä½œæ‰‹å†Œ"
}
```

#### 4.1.4 é¡µé¢è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä»æ–‡æ¡£ä¸­å¿ƒå¯¼å…¥                                                    [å…³é—­]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚  é€‰æ‹©çŸ¥è¯†åº“: [è¿ç»´çŸ¥è¯†åº“ â–¼]                           [åˆ·æ–°ç›®å½•æ ‘]           â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ â–¡ ğŸ“ è¿ç»´çŸ¥è¯†åº“                                                         â”‚ â”‚
â”‚  â”‚   â”œâ”€ â–¡ ğŸ“ Kubernetes                                                    â”‚ â”‚
â”‚  â”‚   â”‚    â”œâ”€ â˜‘ ğŸ“„ Podé‡å¯æ“ä½œæ‰‹å†Œ                                          â”‚ â”‚
â”‚  â”‚   â”‚    â”œâ”€ â˜‘ ğŸ“„ Serviceæ•…éšœæ’æŸ¥                                          â”‚ â”‚
â”‚  â”‚   â”‚    â””â”€ â–¡ ğŸ“„ é›†ç¾¤å‡çº§æŒ‡å—                                             â”‚ â”‚
â”‚  â”‚   â”œâ”€ â–¡ ğŸ“ MySQL                                                         â”‚ â”‚
â”‚  â”‚   â”‚    â”œâ”€ â–¡ ğŸ“„ ä¸»ä»åˆ‡æ¢æµç¨‹                                             â”‚ â”‚
â”‚  â”‚   â”‚    â””â”€ â–¡ ğŸ“„ å¤‡ä»½æ¢å¤æ‰‹å†Œ                                             â”‚ â”‚
â”‚  â”‚   â””â”€ â–¡ ğŸ“ ç›‘æ§å‘Šè­¦                                                      â”‚ â”‚
â”‚  â”‚        â””â”€ â–¡ ğŸ“„ å‘Šè­¦å¤„ç†æµç¨‹                                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                               â”‚
â”‚  å·²é€‰æ‹©: 2 ç¯‡æ–‡æ¡£                                                            â”‚
â”‚                                                                               â”‚
â”‚                                              [å–æ¶ˆ]  [å¼€å§‹å¯¼å…¥]              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 4.2 æ¨¡å—2: æ–‡æ¡£æ ‘ç®¡ç†

#### 4.2.1 åŠŸèƒ½è¯´æ˜

ä»¥æ ‘çŠ¶ç»“æ„å±•ç¤ºå·²å¯¼å…¥çš„æ–‡æ¡£ï¼Œæ”¯æŒæŸ¥çœ‹è¯¦æƒ…ã€ç®¡ç†çŠ¶æ€ã€‚

#### 4.2.2 é¡µé¢è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ“ä½œæ–‡æ¡£åº“                                    [ä»æ–‡æ¡£ä¸­å¿ƒå¯¼å…¥] [æ‰¹é‡æ“ä½œ â–¼] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚  ğŸ” æœç´¢æ–‡æ¡£...                               ç­›é€‰çŠ¶æ€: [å…¨éƒ¨ â–¼]             â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚         æ–‡æ¡£æ ‘                  â”‚              æ–‡æ¡£è¯¦æƒ…                   â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚â”‚
â”‚  â”‚  â”‚ ğŸ“ è¿ç»´çŸ¥è¯†åº“              â”‚  â”‚  â”‚ ğŸ“„ Podé‡å¯æ“ä½œæ‰‹å†Œ               â”‚  â”‚â”‚
â”‚  â”‚  â”‚  â”œâ”€ ğŸ“ Kubernetes         â”‚  â”‚  â”‚                                  â”‚  â”‚â”‚
â”‚  â”‚  â”‚  â”‚   â”œâ”€ ğŸ“„ Podé‡å¯ âœ…     â”‚  â”‚  â”‚ çŠ¶æ€: âœ… å¯æŸ¥è¯¢                  â”‚  â”‚â”‚
â”‚  â”‚  â”‚  â”‚   â”œâ”€ ğŸ“„ Serviceæ•…éšœ ğŸ”„â”‚  â”‚  â”‚ æ¥æº: docs.example.com/k8s/...   â”‚  â”‚â”‚
â”‚  â”‚  â”‚  â”‚   â””â”€ ğŸ“„ é›†ç¾¤å‡çº§ â³   â”‚  â”‚  â”‚ å¯¼å…¥æ—¶é—´: 2024-12-11 10:00       â”‚  â”‚â”‚
â”‚  â”‚  â”‚  â”œâ”€ ğŸ“ MySQL              â”‚  â”‚  â”‚ ç´¢å¼•æ—¶é—´: 2024-12-11 10:05       â”‚  â”‚â”‚
â”‚  â”‚  â”‚  â”‚   â”œâ”€ ğŸ“„ ä¸»ä»åˆ‡æ¢ âœ…   â”‚  â”‚  â”‚                                  â”‚  â”‚â”‚
â”‚  â”‚  â”‚  â”‚   â””â”€ ğŸ“„ å¤‡ä»½æ¢å¤ âŒ   â”‚  â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  â”‚â”‚
â”‚  â”‚  â”‚  â””â”€ ğŸ“ ç›‘æ§å‘Šè­¦           â”‚  â”‚  â”‚                                  â”‚  â”‚â”‚
â”‚  â”‚  â”‚       â””â”€ ğŸ“„ å‘Šè­¦å¤„ç† â³  â”‚  â”‚  â”‚ # Podé‡å¯æ“ä½œæ‰‹å†Œ                â”‚  â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚                                  â”‚  â”‚â”‚
â”‚  â”‚                                  â”‚  â”‚ ## 1. å‰ç½®æ¡ä»¶                   â”‚  â”‚â”‚
â”‚  â”‚  çŠ¶æ€å›¾ä¾‹:                       â”‚  â”‚ - ç¡®è®¤RBACæƒé™                   â”‚  â”‚â”‚
â”‚  â”‚  â³ å¾…å¤„ç†  ğŸ”„ å¤„ç†ä¸­            â”‚  â”‚ - æ£€æŸ¥é›†ç¾¤çŠ¶æ€                   â”‚  â”‚â”‚
â”‚  â”‚  âœ… å¯æŸ¥è¯¢  âŒ å¤±è´¥              â”‚  â”‚ ...                              â”‚  â”‚â”‚
â”‚  â”‚                                  â”‚  â”‚                                  â”‚  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚â”‚
â”‚                                       â”‚                                        â”‚â”‚
â”‚                                       â”‚  [é¢„å¤„ç†å¢å¼º]  [é‡æ–°ç´¢å¼•]  [åˆ é™¤]      â”‚â”‚
â”‚                                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 4.2.3 API è®¾è®¡

```
# è·å–æ–‡æ¡£æ ‘
GET /api/v1/opdoc/tree
Query: knowledge_base_id, status_filter
Response: { "tree": [...] }

# è·å–æ–‡æ¡£è¯¦æƒ…
GET /api/v1/opdoc/documents/{doc_id}
Response: { "id": "...", "name": "...", "content_raw": "...", ... }

# æ›´æ–°æ–‡æ¡£çŠ¶æ€
PATCH /api/v1/opdoc/documents/{doc_id}
Body: { "status": "...", "content_enhanced": "..." }

# æ‰¹é‡æ“ä½œ
POST /api/v1/opdoc/documents/batch
Body: { "action": "index" | "enhance" | "delete", "doc_ids": [...] }
```

---

### 4.3 æ¨¡å—3: é¢„å¤„ç†å¢å¼º (å¯æ‰©å±•)

#### 4.3.1 åŠŸèƒ½è¯´æ˜

å¯¹æ–‡æ¡£è¿›è¡Œé¢„å¤„ç†ï¼Œæå‡åç»­é—®ç­”è´¨é‡ã€‚æ­¤æ¨¡å—è®¾è®¡ä¸º**å¯æ‰©å±•**ï¼ŒåˆæœŸå¯è·³è¿‡ã€‚

#### 4.3.2 å¢å¼ºç­–ç•¥ (åç»­å®ç°)

| ç­–ç•¥ | è¯´æ˜ | å®ç°æ–¹å¼ |
|------|------|---------|
| **ä¸šåŠ¡å…³è”å¢å¼º** | å…³è”ç°æœ‰ä¸šåŠ¡æµç¨‹å›¾è°±ï¼Œè¡¥å……ä¸Šä¸‹æ–‡ | è°ƒç”¨ç°æœ‰ Agent å·¥å…·æŸ¥è¯¢ä¸šåŠ¡ä¿¡æ¯ |
| **å¤šæ¨¡æ€å¤„ç†** | æå–æ–‡æ¡£ä¸­çš„å›¾ç‰‡ï¼Œç”Ÿæˆæ–‡å­—æè¿° | è°ƒç”¨ç°æœ‰ multimodal æœåŠ¡ |
| **ç»“æ„ä¼˜åŒ–** | é‡æ–°ç»„ç»‡æ–‡æ¡£ç»“æ„ï¼Œæå–æ‘˜è¦ | LLM è°ƒç”¨ |
| **å®ä½“é¢„æ ‡æ³¨** | é¢„å…ˆæ ‡æ³¨å…³é”®å®ä½“ã€å‘½ä»¤ã€é…ç½®é¡¹ | LLM è°ƒç”¨ |

#### 4.3.3 å¢å¼ºæµæ°´çº¿è®¾è®¡ (æœªæ¥)

```
åŸå§‹æ–‡æ¡£
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ç»“æ„åˆ†æ      â”‚  â†’ è¯†åˆ«ç« èŠ‚ã€æ­¥éª¤ã€ä»£ç å—
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. å¤šæ¨¡æ€å¤„ç†    â”‚  â†’ å›¾ç‰‡ â†’ æ–‡å­—æè¿° (å¤ç”¨ multimodal)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. ä¸šåŠ¡å…³è”      â”‚  â†’ æŸ¥è¯¢ä¸šåŠ¡å›¾è°±è¡¥å……ä¸Šä¸‹æ–‡ (å¤ç”¨ Agent)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. å†…å®¹è¡¥å…¨      â”‚  â†’ AI è¡¥å……ç¼ºå¤±æ­¥éª¤ã€æ³¨æ„äº‹é¡¹
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–¼
å¢å¼ºåæ–‡æ¡£
```

#### 4.3.4 åˆæœŸå®ç°: ç®€å•é€ä¼ 

```python
async def enhance_document(doc_id: str) -> str:
    """åˆæœŸå®ç°: ç›´æ¥è¿”å›åŸå§‹å†…å®¹ï¼Œä¸åšå¢å¼º"""
    doc = await get_document(doc_id)
    # åç»­åœ¨æ­¤å¤„æ·»åŠ å¢å¼ºé€»è¾‘
    return doc.content_raw
```

---

### 4.4 æ¨¡å—4: LightRAG ç´¢å¼•

#### 4.4.1 åŠŸèƒ½è¯´æ˜

å°†æ–‡æ¡£åŒæ­¥åˆ° LightRAGï¼Œæ„å»ºçŸ¥è¯†ç´¢å¼•ã€‚

#### 4.4.2 LightRAG Service å°è£…

```python
# backend/app/services/opdoc/lightrag_service.py

from lightrag import LightRAG
from lightrag.llm.openai import openai_complete_if_cache, openai_embed

class LightRAGService:
    """LightRAG æœåŠ¡å°è£…"""
    
    _instance: LightRAG | None = None
    
    @classmethod
    async def get_instance(cls) -> LightRAG:
        """è·å– LightRAG å•ä¾‹"""
        if cls._instance is None:
            cls._instance = LightRAG(
                working_dir="./lightrag_data",
                llm_model_func=cls._get_llm_func(),
                embedding_func=cls._get_embedding_func(),
                graph_storage="Neo4JStorage",  # å¤ç”¨ç°æœ‰ Neo4j
            )
            await cls._instance.initialize_storages()
        return cls._instance
    
    @classmethod
    def _get_llm_func(cls):
        """è·å– LLM å‡½æ•° - å¤ç”¨ç°æœ‰é…ç½®"""
        async def llm_func(prompt, system_prompt=None, history_messages=[], **kwargs):
            # ä»ç°æœ‰é…ç½®è·å– API ä¿¡æ¯
            from backend.app.llm.factory import get_llm_config
            config = get_llm_config()
            return await openai_complete_if_cache(
                model=config.model,
                prompt=prompt,
                system_prompt=system_prompt,
                api_key=config.api_key,
                base_url=config.base_url,
                **kwargs
            )
        return llm_func
    
    async def index_document(self, doc_id: str, content: str, metadata: dict) -> bool:
        """ç´¢å¼•å•ä¸ªæ–‡æ¡£"""
        rag = await self.get_instance()
        # æ·»åŠ æ–‡æ¡£æ ‡è¯†å‰ç¼€ï¼Œä¾¿äºè¿½æº¯
        indexed_content = f"[DOC_ID:{doc_id}]\n[TITLE:{metadata.get('title', '')}]\n\n{content}"
        await rag.ainsert(indexed_content)
        return True
    
    async def query(self, question: str, mode: str = "hybrid") -> dict:
        """æŸ¥è¯¢é—®ç­”"""
        rag = await self.get_instance()
        answer = await rag.aquery(question, param=QueryParam(mode=mode))
        return {
            "answer": answer,
            "mode": mode
        }
    
    async def delete_document(self, doc_id: str) -> bool:
        """åˆ é™¤æ–‡æ¡£ç´¢å¼• (éœ€è¦ LightRAG æ”¯æŒ)"""
        # TODO: LightRAG åˆ é™¤ API
        pass
```

#### 4.4.3 API è®¾è®¡

```
# ç´¢å¼•å•ä¸ªæ–‡æ¡£
POST /api/v1/opdoc/index/{doc_id}
Response: { "success": true, "indexed_at": "..." }

# æ‰¹é‡ç´¢å¼•
POST /api/v1/opdoc/index/batch
Body: { "doc_ids": [...] }
Response: { "task_id": "...", "total": 10 }

# æŸ¥çœ‹ç´¢å¼•çŠ¶æ€
GET /api/v1/opdoc/index/status
Response: {
    "total_docs": 42,
    "indexed_docs": 38,
    "pending_docs": 4,
    "entity_count": 386,
    "relation_count": 512
}
```

---

### 4.5 æ¨¡å—5: Chat é—®ç­”

#### 4.5.1 åŠŸèƒ½è¯´æ˜

å¤ç”¨ç°æœ‰ ChatPageï¼Œæ–°å¢ä¸€ä¸ª Agent ç±»å‹ "æ“ä½œæ–‡æ¡£é—®ç­”"ï¼Œåç«¯è°ƒç”¨ LightRAGã€‚

#### 4.5.2 Agent æ³¨å†Œ

```python
# backend/app/llm/langchain/configs.py

AGENT_CONFIGS = {
    # ... ç°æœ‰ Agent
    "knowledge_qa": { ... },
    "log_troubleshoot": { ... },
    "intelligent_testing": { ... },
    
    # æ–°å¢: æ“ä½œæ–‡æ¡£é—®ç­”
    "opdoc_qa": {
        "name": "æ“ä½œæ–‡æ¡£é—®ç­”",
        "description": "åŸºäºæ“ä½œæ‰‹å†Œã€æµç¨‹æ–‡æ¡£çš„æ™ºèƒ½é—®ç­”ï¼Œå¿«é€Ÿè·å–æ“ä½œæ­¥éª¤å’Œè§£å†³æ–¹æ¡ˆ",
        "icon": "FileTextOutlined",
        "type": "lightrag",  # æ–°ç±»å‹ï¼ŒåŒºåˆ«äº langgraph
        "enabled": True,
    }
}
```

#### 4.5.3 Chat è·¯ç”±

```python
# backend/app/api/v1/llm_chat.py

@router.websocket("/ws/chat")
async def chat_websocket(websocket: WebSocket, agent_type: str, thread_id: str):
    await websocket.accept()
    
    if agent_type == "opdoc_qa":
        # èµ° LightRAG è·¯å¾„
        await handle_opdoc_chat(websocket, thread_id)
    else:
        # èµ°ç°æœ‰ LangGraph Agent è·¯å¾„
        await handle_agent_chat(websocket, agent_type, thread_id)


async def handle_opdoc_chat(websocket: WebSocket, thread_id: str):
    """å¤„ç†æ“ä½œæ–‡æ¡£é—®ç­”"""
    lightrag_service = LightRAGService()
    
    while True:
        data = await websocket.receive_json()
        question = data.get("message")
        
        # è°ƒç”¨ LightRAG æŸ¥è¯¢
        result = await lightrag_service.query(question)
        
        # æµå¼è¿”å› (LightRAG æœ¬èº«æ˜¯éæµå¼çš„ï¼Œå¯ä»¥åˆ†æ®µæ¨¡æ‹Ÿ)
        await websocket.send_json({
            "type": "answer",
            "content": result["answer"],
            "sources": result.get("sources", [])  # æ¥æºå¼•ç”¨
        })
```

#### 4.5.4 å‰ç«¯é€‚é…

```typescript
// frontend/src/pages/ChatPage/index.tsx

// ç°æœ‰ Agent åˆ—è¡¨ä¸­æ·»åŠ 
const agentTypes = [
  { key: 'knowledge_qa', name: 'ä¸šåŠ¡çŸ¥è¯†é—®ç­”', icon: <BulbOutlined /> },
  { key: 'log_troubleshoot', name: 'æ—¥å¿—æ’æŸ¥', icon: <BugOutlined /> },
  { key: 'intelligent_testing', name: 'æ™ºèƒ½æµ‹è¯•', icon: <ExperimentOutlined /> },
  // æ–°å¢
  { key: 'opdoc_qa', name: 'æ“ä½œæ–‡æ¡£é—®ç­”', icon: <FileTextOutlined /> },
];

// æ¶ˆæ¯æ¸²æŸ“ç»„ä»¶ä¸­ï¼Œæ ¹æ® sources å­—æ®µæ˜¾ç¤ºæ¥æºå¼•ç”¨
{message.sources && (
  <SourceReferences sources={message.sources} />
)}
```

---

## äº”ã€æŠ€æœ¯æ¶æ„

### 5.1 æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                    å‰ç«¯                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ–°å¢é¡µé¢:                                        å¤ç”¨:                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ /opdoc/import   â”‚  â”‚ /opdoc/library  â”‚        â”‚ /chat           â”‚               â”‚
â”‚  â”‚ æ–‡æ¡£å¯¼å…¥        â”‚  â”‚ æ–‡æ¡£æ ‘ç®¡ç†       â”‚        â”‚ (æ–°å¢agentç±»å‹) â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                            â”‚
                                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                   åç«¯ API                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ–°å¢è·¯ç”±:                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ /api/v1/opdoc/                                                              â”‚    â”‚
â”‚  â”‚  â”œâ”€ /import              æ–‡æ¡£å¯¼å…¥                                           â”‚    â”‚
â”‚  â”‚  â”œâ”€ /tree                æ–‡æ¡£æ ‘                                             â”‚    â”‚
â”‚  â”‚  â”œâ”€ /documents/{id}      æ–‡æ¡£CRUD                                           â”‚    â”‚
â”‚  â”‚  â”œâ”€ /enhance/{id}        é¢„å¤„ç†å¢å¼º                                         â”‚    â”‚
â”‚  â”‚  â””â”€ /index/{id}          LightRAGç´¢å¼•                                       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  å¤ç”¨è·¯ç”±:                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ /api/v1/llm/chat/ws      WebSocket (æ–°å¢ opdoc_qa ç±»å‹è·¯ç”±)                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                            â”‚
                                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                  Service å±‚                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ–°å¢:                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ import_service    â”‚  â”‚ opdoc_service     â”‚  â”‚ lightrag_service  â”‚               â”‚
â”‚  â”‚ æ–‡æ¡£å¯¼å…¥é€»è¾‘       â”‚  â”‚ æ–‡æ¡£æ ‘ç®¡ç†         â”‚  â”‚ LightRAGå°è£…      â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                                      â”‚
â”‚  å¤ç”¨:                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                       â”‚
â”‚  â”‚ multimodal        â”‚  â”‚ history_service   â”‚                                       â”‚
â”‚  â”‚ (å›¾ç‰‡å¤„ç†-æœªæ¥)    â”‚  â”‚ (ä¼šè¯å†å²)         â”‚                                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                            â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼                       â–¼                       â–¼
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚    SQLite    â”‚       â”‚    Neo4j     â”‚       â”‚   LightRAG   â”‚
             â”‚  æ–‡æ¡£å…ƒæ•°æ®   â”‚       â”‚   (å¤ç”¨)     â”‚       â”‚  å‘é‡+å›¾è°±    â”‚
             â”‚  æ ‘çŠ¶ç»“æ„     â”‚       â”‚  å›¾å­˜å‚¨åç«¯  â”‚       â”‚              â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 ç›®å½•ç»“æ„

```
backend/app/
â”œâ”€â”€ api/v1/
â”‚   â”œâ”€â”€ opdoc.py                    # æ–°å¢: æ“ä½œæ–‡æ¡£ç›¸å…³è·¯ç”±
â”‚   â””â”€â”€ llm_chat.py                 # ä¿®æ”¹: æ·»åŠ  opdoc_qa è·¯ç”±åˆ†æ”¯
â”œâ”€â”€ models/
â”‚   â””â”€â”€ opdoc.py                    # æ–°å¢: DocTreeNode, KnowledgeBase, DocIndexMapping
â”œâ”€â”€ schemas/
â”‚   â””â”€â”€ opdoc.py                    # æ–°å¢: è¯·æ±‚/å“åº”æ¨¡å‹
â”œâ”€â”€ services/
â”‚   â””â”€â”€ opdoc/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ import_service.py       # æ–°å¢: æ–‡æ¡£å¯¼å…¥æœåŠ¡
â”‚       â”œâ”€â”€ opdoc_service.py        # æ–°å¢: æ–‡æ¡£ç®¡ç†æœåŠ¡
â”‚       â”œâ”€â”€ enhance_service.py      # æ–°å¢: é¢„å¤„ç†å¢å¼ºæœåŠ¡ (åˆæœŸç©ºå®ç°)
â”‚       â””â”€â”€ lightrag_service.py     # æ–°å¢: LightRAG å°è£…æœåŠ¡
â””â”€â”€ llm/langchain/
    â””â”€â”€ configs.py                  # ä¿®æ”¹: æ·»åŠ  opdoc_qa agent é…ç½®

frontend/src/
â”œâ”€â”€ pages/
â”‚   â””â”€â”€ OpDoc/
â”‚       â”œâ”€â”€ ImportPage.tsx          # æ–°å¢: æ–‡æ¡£å¯¼å…¥é¡µé¢
â”‚       â”œâ”€â”€ LibraryPage.tsx         # æ–°å¢: æ–‡æ¡£æ ‘ç®¡ç†é¡µé¢
â”‚       â””â”€â”€ components/
â”‚           â”œâ”€â”€ DocTree.tsx         # æ–‡æ¡£æ ‘ç»„ä»¶
â”‚           â””â”€â”€ DocDetail.tsx       # æ–‡æ¡£è¯¦æƒ…ç»„ä»¶
â””â”€â”€ router.tsx                      # ä¿®æ”¹: æ·»åŠ  /opdoc/* è·¯ç”±
```

---

## å…­ã€å®æ–½è®¡åˆ’

### Phase 1: åŸºç¡€é“¾è·¯ (1.5å‘¨)

| ä»»åŠ¡ | è¯´æ˜ | é¢„ä¼° |
|------|------|------|
| æ•°æ®æ¨¡å‹ | DocTreeNode, KnowledgeBase è¡¨ç»“æ„ | 0.5å¤© |
| æ–‡æ¡£å¯¼å…¥ | æ¨¡æ‹Ÿ API / æ‰‹åŠ¨å¯¼å…¥ï¼Œæ ‘çŠ¶å­˜å‚¨ | 2å¤© |
| LightRAG é›†æˆ | lightrag_service å°è£… | 2å¤© |
| Chat è·¯ç”± | opdoc_qa ç±»å‹åˆ†æ”¯ï¼ŒWebSocket | 1å¤© |
| å‰ç«¯ Agent å…¥å£ | ChatPage æ·»åŠ æ–° Agent ç±»å‹ | 0.5å¤© |

**äº¤ä»˜ç‰©**: èƒ½è·‘é€š "å¯¼å…¥æ–‡æ¡£ â†’ ç´¢å¼• â†’ Chaté—®ç­”" åŸºç¡€æµç¨‹

### Phase 2: ç®¡ç†ç•Œé¢ (1å‘¨)

| ä»»åŠ¡ | è¯´æ˜ | é¢„ä¼° |
|------|------|------|
| æ–‡æ¡£æ ‘ç®¡ç†é¡µ | æ ‘çŠ¶å±•ç¤ºã€çŠ¶æ€ç­›é€‰ã€è¯¦æƒ…æŸ¥çœ‹ | 2å¤© |
| å¯¼å…¥é¡µé¢ | ä»æ–‡æ¡£ä¸­å¿ƒé€‰æ‹©å¯¼å…¥ | 2å¤© |
| æ‰¹é‡æ“ä½œ | æ‰¹é‡ç´¢å¼•ã€æ‰¹é‡åˆ é™¤ | 1å¤© |

**äº¤ä»˜ç‰©**: å®Œæ•´çš„æ–‡æ¡£ç®¡ç†ç•Œé¢

### Phase 3: å¢å¼ºåŠŸèƒ½ (å¯é€‰ï¼Œ1-2å‘¨)

| ä»»åŠ¡ | è¯´æ˜ | é¢„ä¼° |
|------|------|------|
| æ¥æºè¿½æº¯ | å›ç­”é™„å¸¦å¼•ç”¨ç‰‡æ®µ | 2å¤© |
| é¢„å¤„ç†å¢å¼º | å¤šæ¨¡æ€/ä¸šåŠ¡å…³è” | 3-5å¤© |
| çŸ¥è¯†åº“ç»Ÿè®¡ | å®ä½“/å…³ç³»æ•°é‡å±•ç¤º | 1å¤© |

---

## ä¸ƒã€å­˜å‚¨æ¶æ„

### 7.1 å­˜å‚¨æ–¹æ¡ˆé€‰å‹

| å­˜å‚¨ç±»å‹ | é€‰æ‹© | è¯´æ˜ |
|---------|------|------|
| **å‘é‡å­˜å‚¨** | `NanoVectorDBStorage` | LightRAG é»˜è®¤ï¼Œè½»é‡åµŒå…¥å¼ï¼Œå­˜å‚¨åœ¨æœ¬åœ°æ–‡ä»¶ |
| **å›¾å­˜å‚¨** | `Neo4JStorage` | å¤ç”¨ç°æœ‰ Neo4jï¼Œéœ€åšæ•°æ®éš”ç¦» |
| **KVå­˜å‚¨** | `JsonKVStorage` | é»˜è®¤ï¼Œæœ¬åœ° JSON æ–‡ä»¶ |
| **æ–‡æ¡£çŠ¶æ€** | `JsonDocStatusStorage` | é»˜è®¤ï¼Œæœ¬åœ° JSON æ–‡ä»¶ |

### 7.2 Neo4j æ•°æ®éš”ç¦»æ–¹æ¡ˆ

ç°æœ‰ç³»ç»Ÿå·²åœ¨ Neo4j ä¸­å­˜å‚¨ä¸šåŠ¡å›¾è°±æ•°æ®ï¼ŒLightRAG ä¹Ÿéœ€è¦ä½¿ç”¨ Neo4j å­˜å‚¨çŸ¥è¯†å›¾è°±ã€‚ä¸ºé¿å…æ•°æ®å†²çªï¼Œé‡‡ç”¨ **workspace éš”ç¦»**æ–¹æ¡ˆã€‚

#### éš”ç¦»æœºåˆ¶

LightRAG æ”¯æŒé€šè¿‡ `workspace` å‚æ•°å®ç°é€»è¾‘éš”ç¦»ï¼š

```python
# ç°æœ‰ä¸šåŠ¡ç³»ç»Ÿçš„ Neo4j æ•°æ® (æ—  workspace å‰ç¼€)
# (:Business), (:Step), (:Impl), (:DataResource)

# LightRAG çš„æ•°æ® (å¸¦ workspace å‰ç¼€)
# workspace="opdoc" æ—¶ï¼ŒèŠ‚ç‚¹æ ‡ç­¾ä¼šå˜æˆ:
# (:opdoc___Entity), (:opdoc___Relation), (:opdoc___Chunk)
```

#### é…ç½®ç¤ºä¾‹

```python
# backend/app/services/opdoc/lightrag_service.py

LIGHTRAG_WORKSPACE = "opdoc"  # éš”ç¦»å‰ç¼€

rag = LightRAG(
    working_dir="./lightrag_data",
    llm_model_func=llm_func,
    embedding_func=embedding_func,
    
    # å­˜å‚¨é…ç½®
    graph_storage="Neo4JStorage",           # å¤ç”¨ Neo4j
    vector_storage="NanoVectorDBStorage",   # é»˜è®¤è½»é‡å‘é‡
    kv_storage="JsonKVStorage",             # é»˜è®¤ KV
    doc_status_storage="JsonDocStatusStorage",
    
    # å…³é”®ï¼šworkspace éš”ç¦»
    workspace=LIGHTRAG_WORKSPACE,           # æ‰€æœ‰èŠ‚ç‚¹/å…³ç³»å¸¦æ­¤å‰ç¼€
)
```

#### æ•°æ®ç¤ºä¾‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          Neo4j æ•°æ®åº“                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  ç°æœ‰ä¸šåŠ¡æ•°æ® (æ— å‰ç¼€):                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚  â”‚:Business â”‚â”€â”€â”€â–¶â”‚:Step     â”‚â”€â”€â”€â–¶â”‚:Impl     â”‚                               â”‚
â”‚  â”‚ è®¢å•æµç¨‹  â”‚    â”‚ åˆ›å»ºè®¢å•  â”‚    â”‚ OrderAPI â”‚                               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                                                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                              â”‚
â”‚  LightRAG æ•°æ® (opdoc__ å‰ç¼€):                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚  â”‚:opdoc___Entity â”‚â”€â”€â”€â–¶â”‚:opdoc___Entity â”‚                                   â”‚
â”‚  â”‚ Podé‡å¯        â”‚    â”‚ kubectl        â”‚                                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ç¯å¢ƒå˜é‡

```bash
# .env é…ç½®
# Neo4j è¿æ¥ (å¤ç”¨ç°æœ‰)
NEO4J_URI=neo4j://localhost:7687
NEO4J_USERNAME=neo4j
NEO4J_PASSWORD=your_password

# LightRAG å·¥ä½œç›®å½• (å‘é‡/KV/çŠ¶æ€æ–‡ä»¶å­˜å‚¨)
LIGHTRAG_WORKING_DIR=./lightrag_data
LIGHTRAG_WORKSPACE=opdoc
```

### 7.3 æ–‡ä»¶å­˜å‚¨ç»“æ„

```
lightrag_data/
â”œâ”€â”€ nano_vectordb/           # NanoVectorDB å‘é‡å­˜å‚¨
â”‚   â”œâ”€â”€ vdb_entities.json    # å®ä½“å‘é‡
â”‚   â”œâ”€â”€ vdb_relations.json   # å…³ç³»å‘é‡
â”‚   â””â”€â”€ vdb_chunks.json      # æ–‡æœ¬å—å‘é‡
â”œâ”€â”€ kv_store/                # JsonKVStorage
â”‚   â”œâ”€â”€ entities.json
â”‚   â””â”€â”€ relations.json
â””â”€â”€ doc_status.json          # æ–‡æ¡£å¤„ç†çŠ¶æ€
```

---

## å…«ã€å¾…ç¡®è®¤äº‹é¡¹

1. **æ–‡æ¡£ä¸­å¿ƒ API æ ¼å¼**ï¼šéœ€è¦ç¡®è®¤å®é™…çš„ API æ¥å£æ ¼å¼å’Œè®¤è¯æ–¹å¼
2. **ä¼šè¯å†å²**ï¼šopdoc_qa çš„å¯¹è¯å†å²æ˜¯å¦éœ€è¦æŒä¹…åŒ–ï¼Ÿæ˜¯å¦å¤ç”¨ç°æœ‰ Checkpointerï¼Ÿ
3. **æƒé™æ§åˆ¶**ï¼šä¸åŒçŸ¥è¯†åº“æ˜¯å¦éœ€è¦æƒé™éš”ç¦»ï¼Ÿ

---

## é™„å½•: LightRAG å®‰è£…ä¸é…ç½®

### å®‰è£…

```bash
# å®‰è£… LightRAG (åŒ…å« Neo4j æ”¯æŒ)
pip install lightrag-hku[neo4j]
```

### ç¯å¢ƒå˜é‡

```bash
# Neo4j é…ç½® (å¤ç”¨ç°æœ‰å®ä¾‹)
export NEO4J_URI="neo4j://localhost:7687"
export NEO4J_USERNAME="neo4j"
export NEO4J_PASSWORD="your_password"

# LightRAG é…ç½®
export LIGHTRAG_WORKING_DIR="./lightrag_data"
export LIGHTRAG_WORKSPACE="opdoc"
```

### åˆå§‹åŒ–ä»£ç 

```python
import os
from lightrag import LightRAG
from lightrag.llm.openai import gpt_4o_mini_complete, openai_embed
from lightrag.kg.shared_storage import initialize_pipeline_status

async def create_lightrag_instance():
    rag = LightRAG(
        working_dir=os.getenv("LIGHTRAG_WORKING_DIR", "./lightrag_data"),
        llm_model_func=gpt_4o_mini_complete,
        embedding_func=openai_embed,
        graph_storage="Neo4JStorage",
        vector_storage="NanoVectorDBStorage",
        workspace=os.getenv("LIGHTRAG_WORKSPACE", "opdoc"),
    )
    await rag.initialize_storages()
    await initialize_pipeline_status()
    return rag
```
